<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<!-- Usando o template com sidebar -->
<ui:composition template="/WEB-INF/template-with-sidebar.xhtml">

	<!-- T√≠tulo da p√°gina -->
	<ui:define name="title">Agendamentos - BarberSys</ui:define>
	
	<!-- CSS espec√≠fico desta p√°gina -->
	<ui:define name="extra-css">
		<h:outputScript library="primefaces" name="locales/locale-pt.js" />
		
		<style>
.content-info-lateral {
	background: #FCFCFF;
}

/* ============================================ */
/* STEPS CUSTOMIZADOS */
/* ============================================ */
body .ui-steps {
	background: transparent !important;
	border: none !important;
	margin-bottom: 30px !important;
}

body .ui-steps .ui-steps-item {
	background: transparent !important;
}

body .ui-steps .ui-steps-item .ui-menuitem-link {
	background: transparent !important;
	padding: 1rem !important;
	border: none !important;
	transition: all 0.3s ease !important;
}

body .ui-steps .ui-steps-item .ui-steps-number {
	background: #E5E7EB !important;
	color: #6B7280 !important;
	border: 3px solid #E5E7EB !important;
	width: 40px !important;
	height: 40px !important;
	line-height: 34px !important;
	font-size: 16px !important;
	font-weight: 700 !important;
	box-shadow: none !important;
	transition: all 0.4s ease !important;
}

body .ui-steps .ui-steps-item.ui-state-highlight .ui-steps-number {
	background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%) !important;
	color: #FFFFFF !important;
	border-color: #6366F1 !important;
	box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3) !important;
	transform: scale(1.1);
}

body .ui-steps .ui-steps-item .ui-steps-title {
	color: #6B7280 !important;
	font-weight: 600 !important;
	font-size: 14px !important;
	margin-top: 8px !important;
	transition: all 0.4s ease !important;
}

body .ui-steps .ui-steps-item.ui-state-highlight .ui-steps-title {
	color: #6366F1 !important;
}

/* Conte√∫do dos steps com anima√ß√£o */
.step-content {
	animation: step-enter-animation 0.5s ease-out;
	padding: 20px 0;
}

@keyframes step-enter-animation {
	from {
		opacity: 0;
		transform: translateY(15px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* Bot√µes de navega√ß√£o dos steps */
.step-buttons {
	display: flex;
	justify-content: space-between;
	margin-top: 30px;
	gap: 15px;
	    position: sticky;
    bottom: -20px;
    background: #ededed;
    padding: 10px 20px;
    margin: 20px -20px -20px;
}

.btn-step {
	padding: 12px 30px !important;
	font-size: 14px !important;
	font-weight: 600 !important;
	border-radius: 40px !important;
	transition: all 0.3s ease !important;
	text-transform: uppercase !important;
	letter-spacing: 0.5px !important;
}

.btn-step-previous {
	background: #F3F4F6 !important;
	border: 1px solid #E5E7EB !important;
	color: #374151 !important;
}

.btn-step-previous:hover {
	background: #E5E7EB !important;
	transform: translateY(-2px) !important;
	box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
}

.btn-step-next {
	background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%) !important;
	border: none !important;
	color: #FFFFFF !important;
}

.btn-step-next:hover:not(:disabled) {
	transform: translateY(-2px) !important;
	box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4) !important;
}

.btn-step-finish {
	background: linear-gradient(135deg, #10B981 0%, #059669 100%) !important;
	border: none !important;
	color: #FFFFFF !important;
}

.btn-step-finish:hover:not(:disabled) {
	transform: translateY(-2px) !important;
	box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4) !important;
}

.btn-step:disabled {
	opacity: 0.5 !important;
	cursor: not-allowed !important;
}

.btn-step-next:disabled, .btn-step-next.ui-state-disabled {
	background: #9CA3AF !important; /* Cinza mais escuro para melhor legibilidade */
	color: #FFFFFF !important;
}

.btn-step-finish:disabled, .btn-step-finish.ui-state-disabled {
	background: #9CA3AF !important; /* Cinza mais escuro para melhor legibilidade */
	color: #FFFFFF !important;
}

/* Layout dos steps em grid */
.step-grid {
	display: grid;
	grid-template-columns: 1fr;
	gap: 20px;
	margin: 20px 0;
}

.step-grid-full {
	grid-column: 1 / -1;
}

/* Estilos para input de pesquisa */
.input-combined-no-text {
	position: relative;
}

.input-combined-no-text .ui-inputfield,
.input-combined-no-text .ui-inputfield.ui-state-focus,
.input-combined-no-text .ui-inputfield.ui-state-hover {
	height: 46px !important;
	position: relative;
	width: 100%;
	font-size: 14px;
	color: #656464;
	font-weight: 600;
	font-family: "Barlow";
	border-radius: 8px !important;
	box-shadow: none !important;
	border-color: #ced4da !important;
	padding-right: 40px !important;
	display: flex;
	align-items: center;
}

.input-combined-no-text i {
	position: absolute;
	right: 17px;
	top: 14px;
	color: #999;
	font-size: 16px;
	pointer-events: none;
}
/* ============================================ */

/* Estilos para datas desabilitadas no datepicker */
.ui-datepicker .ui-state-disabled {
	opacity: 0.4 !important;
	cursor: not-allowed !important;
	background-color: #f5f5f5 !important;
	color: #999 !important;
}

.ui-datepicker .ui-datepicker-unselectable {
	cursor: not-allowed !important;
}

.ui-datepicker .ui-datepicker-unselectable a {
	pointer-events: none !important;
	color: #ccc !important;
	text-decoration: line-through !important;
}

.header-filters {
	margin-top: 9px;
}

.perfil-top-funcionario {
	height: 28px;
	width: 28px;
	background-size: cover;
	margin: 0;
}

body .ui-datatable thead tr:not(.ui-datatable-empty-message), body .ui-datatable tbody tr:not(.ui-datatable-empty-message)
	{
	display: grid;
	grid-template-columns: 40px 1fr 1fr 87px 110px 70px 130px;
}

body .ui-datatable thead th:first-child:not(.ui-datatable-empty-message),
	body .ui-datatable tbody td:first-child:not(.ui-datatable-empty-message),
	body .ui-datatable thead th:nth-child(5):not(.ui-datatable-empty-message),
	body .ui-datatable tbody td:nth-child(5):not(.ui-datatable-empty-message),
	body .ui-datatable thead th:nth-child(6):not(.ui-datatable-empty-message),
	body .ui-datatable tbody td:nth-child(6):not(.ui-datatable-empty-message)
	{
	text-align: center !important;
}

body .ui-datatable .ui-datatable-data>tr>td[colspan="6"] {
	height: 514px;
	font-size: 17px;
}

.data-select-custom {
	background-color: orange !important;
}

body .ui-datatable .ui-datatable-even>td {
	background-color: transparent;
}

.ui-datatable-even {
	background-color: #F6F7FB !important;
}

.list-time {
	position: relative;
}

.list-time>div:first-of-type .fa-solid {
	left: 12px;
}

/* === CSS CARDS DE SERVI√áOS (IGUAL AGENDAMENTOCLIENTE) === */

/* Grid de servi√ßos - 3 colunas */
.services-grid-cliente {
	margin-bottom: 30px;
	max-height: 233px;
	overflow: auto;
}

body .services-datagrid-cliente.ui-datagrid {
	background: transparent;
	border: none;
}

body .services-datagrid-cliente .ui-datagrid-content {
	background: transparent;
	border: none;
	padding: 0px;
}

body .services-datagrid-cliente .ui-g {
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	gap: 10px;
	margin: 0;
}


body .services-datagrid-cliente .ui-g-12 {
	padding: 0;
	margin: 0;
	width: 100%;
}

.services-datagrid-cliente .ui-datagrid-empty-message {
	grid-column: 1 / -1;
	text-align: center;
	padding: 80px 20px;
	color: #9CA3AF;
	font-size: 16px;
	font-weight: 600;
}

.services-datagrid-cliente .ui-datagrid-empty-message::before {
	content: 'üö´';
	display: block;
	font-size: 48px;
	margin-bottom: 12px;
	opacity: 0.5;
}

/* Card de servi√ßo */
.service-card-cliente {
	background: #EBEBEB;
	border-radius: 8px;
	padding: 10px;
	display: flex;
	align-items: center;
	gap: 12px;
	cursor: pointer;
	transition: all 0.2s ease;
	border: 2px solid transparent;
	min-height: 70px;
}

.service-card-cliente:hover:not(.disabled) {
	background: #DCDCDC;
	border-color: #C0C0C0;
}

.service-card-cliente.disabled {
	opacity: 0.6;
	cursor: not-allowed;
}

/* Checkbox customizado */
.service-card-cliente .ui-chkbox {
	margin-top: 3px;
}

.service-card-cliente .ui-chkbox .ui-chkbox-box {
	width: 20px;
	height: 20px;
	border: 2px solid #666;
	border-radius: 4px;
	background: #FFF;
}

.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-active {
	background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
	border-color: #6366F1 !important;
}

/* Remove TODOS os hovers do checkbox */
.service-card-cliente .ui-chkbox .ui-chkbox-box:hover,
.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-hover,
.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-active:hover,
.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-active.ui-state-hover {
	background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
	border-color: #6366F1 !important;
}

.service-card-cliente .ui-chkbox .ui-chkbox-box:not(.ui-state-active):hover,
.service-card-cliente .ui-chkbox .ui-chkbox-box:not(.ui-state-active).ui-state-hover {
	background: #FFF !important;
	border-color: #666 !important;
}

.service-card-cliente .ui-chkbox .ui-chkbox-box .ui-chkbox-icon {
	color: #FFF;
	top: 4px;
}

/* Informa√ß√µes do servi√ßo */
.service-info-cliente {
	display: flex;
	flex-direction: column;
	gap: 4px;
	flex: 1;
	cursor: pointer;
}

.service-name-cliente {
	font-size: 12px;
	font-weight: 600;
	color: #5A5A5A;
	text-transform: uppercase;
	letter-spacing: 0.3px;
	line-height: 1.2;
}

.service-price-cliente {
	font-size: 17px;
	font-weight: bold;
	color: #000;
	line-height: 1;
}

.service-duration-cliente {
	font-size: 14px !important;
	font-weight: 700 !important;
	color: #4F46E5 !important;
	background-color: rgba(99, 102, 241, 0.1);
	padding: 4px 8px;
	border-radius: 6px;
	display: flex;
	align-items: center;
	gap: 6px;
	border: 1px solid rgba(99, 102, 241, 0.2);
}

.service-duration-cliente i {
	color: #4F46E5 !important;
}

.header-modal{
margin-bottom: 0px
}

/* ============================================ */
/* ESTILOS PARA RESPONSIVIDADE DO MODAL        */
/* ============================================ */
.dialog-agendamento-custom .ui-dialog-content {
	min-height: 500px !important;
	max-height: calc(90vh - 100px) !important;
	overflow-y: auto !important;
	padding: 20px !important;
}

/* For√ßa o modal a sempre ficar centralizado */
.dialog-agendamento-custom.ui-dialog {
	position: fixed !important;
	left: 50% !important;
	top: 50% !important;
	transform: translate(-50%, -50%) !important;
	margin: 0 !important;
}

/* Garante largura de 800px e centraliza√ß√£o */
.dialog-agendamento-custom {
	width: 800px !important;
	max-width: 95vw !important;
}

/* For√ßa o modal a sempre ficar centralizado */
.dialog-agendamento-custom.ui-dialog {
	position: fixed !important;
	left: 50% !important;
	top: 50% !important;
	transform: translate(-50%, -50%) !important;
	margin: 0 !important;
}

/* Mensagens de erro n√£o aumentam o modal */
.dialog-agendamento-custom .ui-messages,
.messages-modal-fixed {
	max-width: 100% !important;
	overflow-wrap: break-word !important;
	word-wrap: break-word !important;
	margin-bottom: 15px !important;
	box-sizing: border-box !important;
}

/* For√ßa recalculo de posi√ß√£o quando mensagem aparece */
.dialog-agendamento-custom.ui-dialog.ui-widget-content {
	position: fixed !important;
	left: 50% !important;
	top: 50% !important;
	transform: translate(-50%, -50%) !important;
	transition: none !important;
}

/* Grid de servi√ßos sempre ocupa espa√ßo fixo */
.services-grid-cliente {
	min-height: 233px;
	max-height: 233px;
	overflow-y: auto;
	position: relative;
}

/* Step content sem altura m√≠nima fixa */
.step-content {
	animation: step-enter-animation 0.5s ease-out;
	padding: 0;
	min-height: auto;
}

/* Scrollbar customizada */
.modal-content-scrollable::-webkit-scrollbar {
	width: 8px;
}

.modal-content-scrollable::-webkit-scrollbar-track {
	background: #f1f1f1;
	border-radius: 4px;
}

.modal-content-scrollable::-webkit-scrollbar-thumb {
	background: #888;
	border-radius: 4px;
}

.modal-content-scrollable::-webkit-scrollbar-thumb:hover {
	background: #555;
}

.header-modal{
margin-bottom: 0px
}

.img-custom{
	    max-width: 380px;
    max-height: 380px;
}

.sidebar-empty{
	display: flex;
    height: 100%;
    align-items: center;
    justify-content: center;
}

.services-scroll.dataList-dialog-custom ul[class="ui-datalist-data"] {
    overflow-y: auto;
       max-height: calc(100vh - 579px);
}

.content-info-cliente{
	    display: flex;
    flex-direction: column;
    gap: 7px;
    margin-top: 8px;
	
}

.content-card-info-cliente {
        height: auto;
    background: #DFDFDF;
    padding: 8px 20px;
    border-radius: 8px;
    max-height: 78px;
    overflow-y: auto;
    overflow-x: hidden;
}

/* ============================================ */
/* INDICADORES DE STATUS NO FILTRO              */
/* ============================================ */
.header-filters .content-filter .ui-selectonebutton .ui-button {
    position: relative !important;
}

/* Adiciona espa√ßo apenas nos bot√µes que ter√£o o indicador */
.header-filters .content-filter .ui-selectonebutton .ui-button:nth-child(n+2) {
	padding-left: 28px !important;
}

.header-filters .content-filter .ui-selectonebutton .ui-button::before {
    content: '';
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: transparent;
    transition: all 0.3s ease;
}

/* "Todos" n√£o tem cor */
.header-filters .content-filter .ui-selectonebutton .ui-button:nth-child(1)::before {
    display: none;
}

/* Cor para "Pendentes" (Amarelo) */
.header-filters .content-filter .ui-selectonebutton .ui-button:nth-child(2)::before {
    background-color: #FFC107;
}

/* Cor para "Finalizados" (Verde) */
.header-filters .content-filter .ui-selectonebutton .ui-button:nth-child(3)::before {
    background-color: #23C538;
}

/* Cor para "Cancelados" (Vermelho) */
.header-filters .content-filter .ui-selectonebutton .ui-button:nth-child(4)::before {
    background-color: #C52323;
}

/* Ajuste para o estado ativo/selecionado */
.header-filters .content-filter .ui-selectonebutton .ui-button.ui-state-active::before {
	box-shadow: 0 0 0 2px #fff, 0 0 0 4px #6B7280; /* Anel cinza para manter a neutralidade */
}

.services-datagrid-cliente .ui-datagrid-content-empty{
  padding: 20px !important;
  font-weight: bold !important;
  text-align: center !important;
}

		</style>
	</ui:define>

	<!-- Conte√∫do CENTRAL da p√°gina -->
	<ui:define name="content">
	
		<!-- T√≠tulo e A√ß√µes -->
		<div class="flex space-between align-items-center">
					<p:outputLabel class="title-page" value="Agendamentos" />
					<div class="flex align-items-center">
						<h:outputText value="#{agendamentoController.dataFiltro}" styleClass="mr-3">
				            <f:convertDateTime pattern="dd/MM/yyyy" />
				            
				        </h:outputText>
						<p:commandButton id="calendarBtn" type="button" icon="fa-solid fa-calendar" styleClass="btn-circle"/>
						<p:commandButton update="dttDataSelect"
							actionListener="#{agendamentoController.novoAgendamento()}"
							process="@this" class="btn btn-green ml-2" value="Agendar Cliente"
							onclick="PF('dlgAgendar').show()" />
					</div>
				</div>

				<p:overlayPanel for="calendarBtn" widgetVar="dateOverlay" styleClass="p-3">
				    <div class="d-flex flex-column">
				        <p:outputLabel value="Data selecionada: " styleClass="font-weight-bold mb-2"/>
				        <h:outputText value="#{agendamentoController.dataFiltro}" styleClass="mb-3">
				            <f:convertDateTime pattern="dd/MM/yyyy" />
				        </h:outputText>
				        <p:datePicker value="#{agendamentoController.dataFiltro}" showIcon="true" pattern="dd/MM/yyyy" inline="true">
				            <p:ajax event="dateSelect" update="@form" process="@this" oncomplete="PF('dateOverlay').hide()"/>
				        </p:datePicker>
				    </div>
				</p:overlayPanel>

				<div class="header-filters">
					<div class="row">
						<div class="col-md-2 input-combined-no-text">
							<p:inputText value="#{agendamentoController.nomeClienteFiltro}"
								autocomplete="off" placeholder="Pesquisar cliente">
								<p:ajax event="keyup" delay="100" update="@form" process="@this" />
							</p:inputText>
							<i class="fa-solid fa-magnifying-glass"></i>
						</div>
						<div class="col-md-3 input-combined-no-text">
							<p:selectOneMenu
								value="#{agendamentoController.nomeFuncionarioFiltro}"
								filter="true" filterMatchMode="startsWith">
								<f:selectItem itemLabel="Selecione um funcion√°rio" />
								<f:selectItems var="func"
									value="#{agendamentoController.lstFuncionario}"
									itemLabel="#{func.nome}" itemValue="#{func.nome}" />
								<p:ajax update="@form" process="@this" />
							</p:selectOneMenu>
						</div>
						<div class="col-md-7">
							<div class="content-filter ">
								<i class="fa-solid fa-filter"></i>
								<p:selectOneButton
									value="#{agendamentoController.statusSelecionado}"
									unselectable="false">
									<f:selectItem itemLabel="Todos" itemValue="" />
									<f:selectItem itemLabel="Pendentes" itemValue="A" />
									<f:selectItem itemLabel="Finalizados" itemValue="F" />
									<f:selectItem itemLabel="Cancelados" itemValue="I" />
									<p:ajax update="@form" process="@this" />
								</p:selectOneButton>
							</div>
						</div>
					</div>
				</div>

				<div>
					<p:dataTable id="datatableCaixas"
						value="#{agendamentoController.lstAgendamentos}" var="agend"
						rowKey="#{agend.id}"
						selection="#{agendamentoController.agendamentoModel}"
						selectionMode="single" paginator="true" paginatorPosition="bottom"
						rows="13" lazy="true" emptyMessage="Nenhum dado encontrado">

						<p:ajax event="rowSelect" update="@form"
							listener="#{agendamentoController.agendamentoSelecionado}" />

						<p:column styleClass="flex justify-center align-center"
							headerText="Status">
							<div
								class="status-table #{agend.status eq 'A' ? 'aguardando' : agend.status eq 'F' ? 'ativo' : 'inativo'}">
							</div>
						</p:column>

						<p:column styleClass="flex align-center" headerText="Cliente">
							<ui:fragment rendered="#{agend.cliente.id eq null}">
								<h:outputText value="#{agend.nomeClienteAvulso}" />
							</ui:fragment>
							<ui:fragment rendered="#{agend.cliente.id != null}">
								<h:outputText value="#{agend.cliente.nome}" />
							</ui:fragment>
						</p:column>

						<p:column styleClass="flex align-center" headerText="Funcion√°rio">
							<h:outputText value="#{agend.funcionario.nome}" />
						</p:column>

						<p:column styleClass="flex align-center" headerText="Data">
							<h:outputText value="#{agend.dataCriado}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>

						<p:column styleClass="flex align-center justify-center"
							headerText="Quant. Servi√ßos">
							<h:outputText value="#{agend.servicos.size()}" />
						</p:column>

						<p:column styleClass="flex align-center justify-center"
							headerText="Hor√°rio">
							<h:outputText styleClass="title-date-table"
								value="#{agend.horaSelecionada}" />
						</p:column>
						
						<p:column styleClass="flex align-center justify-center"
							headerText="Tempo Servi√ßos">
							<span style="display: inline-flex; align-items: center; gap: 6px; 
								background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%); 
								color: #FFFFFF; padding: 6px 12px; border-radius: 6px; 
								font-weight: 700; font-size: 13px; box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2); width: 100%;">
								<i class="pi pi-clock" style="font-size: 12px;"></i>
								<h:outputText value="#{agend.duracaoTotalFormatada}" />
							</span>
						</p:column>
					</p:dataTable>
				</div>

		<!-- Modais de agendamento, cancelamento e estorno -->
		<p:dialog id="dlgAgendar" widgetVar="dlgAgendar" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false" focus="proximoButton"
			responsive="true" fitViewport="true" dynamic="true"
			width="700" minHeight="500" maximizable="false"
			styleClass="dialog-agendamento-custom"
			style="max-width: 90vw; max-height: 90vh;">
			<h:panelGroup id="dttDataSelect">
				<div class="header-modal">
					<div class="flex align-center">
						<div class="icon-circle">
							<ui:fragment
								rendered="#{agendamentoController.editarModel eq 'A'}">
								<i class="fa-solid fa-pen"></i>
							</ui:fragment>
							<ui:fragment
								rendered="#{agendamentoController.editarModel eq 'I'}">
								<i class="fa-solid fa-calendar-days"></i>
							</ui:fragment>
						</div>
						<label>#{agendamentoController.editarModel eq 'A' ? 'Editar Agendamento' : 'Novo Agendamento'}</label>
					</div>
					<div class="flex align-center" style="gap: 8px;">
						<!-- Bot√£o Cancelar Agendamento - Aparece apenas ao editar -->
						<p:commandButton 
							styleClass="btn-cancelar-agendamento-text" 
							icon="fa-solid fa-ban"
							value="Cancelar Agendamento"
							rendered="#{agendamentoController.editarModel eq 'A'}"
							type="button"
							onclick="PF('dlgConfirmCancel').show();" />
						
						<!-- Bot√£o Fechar (X) -->
						<p:commandButton styleClass="btn-x" icon="fa-solid fa-xmark"
							onclick="PF('dlgAgendar').hide()" />
					</div>
				</div>

				<p:messages id="msgs" closable="true" showIcon="true" 
					styleClass="messages-modal-fixed" />
				
				<!-- Steps do PrimeFaces -->
				<p:steps id="stepsComponent" 
					activeIndex="#{agendamentoController.passos}" 
					widgetVar="stepsModalWV"
					styleClass="custom-steps"
					readonly="true"
					style="margin-bottom: 30px;">
					<p:menuitem value="Cliente e Funcion√°rio" />
					<p:menuitem value="Data e Servi√ßos" />
					<p:menuitem value="Hor√°rio e Confirma√ß√£o" />
				</p:steps>

				<ui:fragment rendered="#{agendamentoController.passos eq 0}">
					<div class="step-content">
						<ui:fragment rendered="#{agendamentoController.editarModel eq 'I'}">
							<div style="margin-bottom: 20px;">
								<div class="content-filter no-filter">
									<p:selectOneButton
										value="#{agendamentoController.tipoCadastro}"
										unselectable="false">
										<f:selectItem itemLabel="Com cadastro" itemValue="A" />
										<f:selectItem itemLabel="Sem cadastros" itemValue="I" />
										<p:ajax update="dttDataSelect" process="@this" 
											listener="#{agendamentoController.onTipoCadastroChange}" />
									</p:selectOneButton>
								</div>
							</div>
						</ui:fragment>

						<div class="step-grid">
							<p:outputPanel id="dlgAttCliente" styleClass="step-grid-full">
								<ui:fragment
									rendered="#{agendamentoController.tipoCadastro eq 'A'}">
									<div class="input-combined">
										<p:outputLabel styleClass="title-input"
											value="Nome do Cliente" />
										<p:selectOneMenu value="#{agendamentoController.clienteId}"
											filter="true" filterMatchMode="startsWith" style="width: 100%;"
											disabled="#{agendamentoController.editarModel eq 'A'}">
											<f:selectItem itemLabel="Selecione um cliente" />
											<f:selectItems var="cli"
												value="#{agendamentoController.lstCliente}"
												itemLabel="#{cli.nome}" itemValue="#{cli.id}" />
											<p:ajax event="change" update="@(.total-update)" process="@this" />
											<f:facet name="footer">
												<p:divider styleClass="mt-0" />
												<h:outputText
													value="#{agendamentoController.lstCliente.size()} Clientes encontrados"
													style="font-weight:bold;" />
											</f:facet>
										</p:selectOneMenu>
									</div>
								</ui:fragment>
								<ui:fragment
									rendered="#{agendamentoController.tipoCadastro eq 'I'}">
									<div class="input-combined">
										<p:outputLabel styleClass="title-input"
											value="Nome do Cliente" />
										<p:inputText value="#{agendamentoController.nomeCliente}"
											styleClass="senha-login" style="width: 100%;"
											disabled="#{agendamentoController.editarModel eq 'A'}">
											<p:ajax event="keyup" update="@(.total-update)" process="@this" />
										</p:inputText>
									</div>
								</ui:fragment>
							</p:outputPanel>
						</div>
						
						<div class="step-grid">
							<div class="input-combined step-grid-full">
								<p:outputLabel styleClass="title-input"
									value="Nome do Funcion√°rio" />
								<p:selectOneMenu value="#{agendamentoController.nomeFuncionario}"
									filter="true" filterMatchMode="startsWith" style="width: 100%;"
									disabled="#{agendamentoController.agendamentoPassado}">
									<f:selectItem itemLabel="Selecione um funcion√°rio" />
									<f:selectItems var="func"
										value="#{agendamentoController.lstFuncionario}"
										itemLabel="#{func.nome}" itemValue="#{func.nome}" />
									<p:ajax event="change"
										update="@(.total-update)" process="@this" />
									<f:facet name="footer">
										<p:divider styleClass="mt-0" />
										<h:outputText
											value="#{agendamentoController.lstFuncionario.size()} Funcion√°rios dispon√≠veis"
											style="font-weight:bold;" />
									</f:facet>
								</p:selectOneMenu>
							</div>
						</div>
						
						<!-- Bot√µes do Passo 1 -->
						<div class="step-buttons">
							<div></div>
							<p:commandButton id="proximoButton" styleClass="btn-step btn-step-next total-update" 
								value="Pr√≥ximo"
								update="dttDataSelect msgs"
								process="dttDataSelect" 
								actionListener="#{agendamentoController.addPassosAgendamento()}"
								disabled="#{agendamentoController.proximoDisabled}"
								oncomplete="setTimeout(function(){ PF('dlgAgendar').initPosition(); }, 100);" />
						</div>
					</div>
				</ui:fragment>

				<ui:fragment rendered="#{agendamentoController.passos eq 1}">
					<div class="row">
						<div class="col-md-12">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input"
									value="Selecione uma data" />
								<p:datePicker id="inputData" widgetVar="dlgDatePicker"
									value="#{agendamentoController.dataSelecionada}"
									showIcon="true" pattern="dd/MM/yyyy" autocomplete="off"
									mindate="#{agendamentoController.today}"
									disabledDates="#{agendamentoController.datasDesabilitadasDate}"
									disabled="#{agendamentoController.agendamentoPassado}"
									locale="pt"
									onkeydown="return false;">
									<p:ajax event="dateSelect"
										listener="#{agendamentoController.filtrarFuncionariosPorData}"
										update="proximoButton servicosGridPanel totaisPanel" process="@this" />
								</p:datePicker>
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12">
							<div>
		
								<!-- Cards de Totais -->
								<p:outputPanel id="totaisPanel" styleClass="total-update" style="width: 100%;">
									<div style="display: flex; gap: 12px; margin-bottom: 16px; margin-top: 15px;">
										<div style="width: 50%; padding: 12px 16px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 10px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
											<div style="display: flex; align-items: center; gap: 10px;">
												<div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; min-width: 32px; height: 32px;">
													<i class="fa-solid fa-dollar-sign" style="color: #FFFFFF; font-size: 14px;"></i>
												</div>
												<div style="flex: 1;">
													<div style="font-size: 10px; color: rgba(255,255,255,0.95); font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 2px;">Valor Total</div>
													<div style="font-size: 18px; color: #FFFFFF; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.1);"> 
														R$ <h:outputText value="#{agendamentoController.valorTotalSelecionado}">
															<f:convertNumber pattern="0.00" groupingUsed="false" />
														</h:outputText>
													</div>
												</div>
											</div>
										</div>
										<div style="width: 50%; padding: 12px 16px; background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%); border-radius: 10px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);">
											<div style="display: flex; align-items: center; gap: 10px;">
												<div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; min-width: 32px; height: 32px;">
													<i class="fa-regular fa-clock" style="color: #FFFFFF; font-size: 14px;"></i>
												</div>
												<div style="flex: 1;">
													<div style="font-size: 10px; color: rgba(255,255,255,0.95); font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 2px;">Tempo Total</div>
													<div style="font-size: 18px; color: #FFFFFF; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">
														#{agendamentoController.tempoTotalFormatado}
													</div>
												</div>
											</div>
										</div>
									</div>
								</p:outputPanel>
								
								<h3 style="font-size: 16px; font-weight: 700; color: #374151; margin: 24px 0 16px 0;">Servi√ßos dispon√≠veis</h3>
								
								<!-- Campo de pesquisa -->
								<div class="input-combined-no-text" style="margin-bottom: 16px;">
									<p:inputText id="filtroServicoModal"
										value="#{agendamentoController.filtroServico}"
										placeholder="Pesquisar servi√ßos..."
										autocomplete="off">
										<p:ajax event="keyup" delay="300"
											listener="#{agendamentoController.filtrarServicos}"
											update="servicosGridPanel"
											process="@this" />
									</p:inputText>
									<i class="fa-solid fa-magnifying-glass"></i>
								</div>
								
								<!-- Grid de servi√ßos em cards - IGUAL AGENDAMENTOCLIENTE -->
								<p:outputPanel id="servicosGridPanel">
									<div class="services-grid-cliente">
										<p:dataGrid var="servico"
											value="#{agendamentoController.servicosFiltrados}"
											columns="3" layout="grid"
											styleClass="services-datagrid-cliente"
											emptyMessage="Nenhum servi√ßo encontrado.">
											
											<div class="service-card-cliente"
												onclick="document.getElementById('form:dlgAgendar:chk_#{servico.id}').click();">
												
												<p:selectBooleanCheckbox 
													id="chk_#{servico.id}"
													value="#{agendamentoController.servicosSelecionadosMap[servico.id]}"
													disabled="#{agendamentoController.agendamentoPassado}">
													<p:ajax event="change"
														listener="#{agendamentoController.aoSelecionarServicoModal}"
														update="@(.total-update)" 
														process="@this" />
												</p:selectBooleanCheckbox>
												
												<div class="service-info-cliente">
													<h:outputText value="#{servico.nome}"
														styleClass="service-name-cliente" />
													
													<div style="display: flex; align-items: center; gap: 12px; margin-top: 10px;">
														<span class="service-price-cliente"> 
															R$ <h:outputText value="#{servico.preco}">
																<f:convertNumber pattern="0.00" groupingUsed="false" />
															</h:outputText>
														</span>
														
														<span class="service-duration-cliente">
															<i class="pi pi-clock"></i>
															#{servico.minutos} min
														</span>
													</div>
												</div>
											</div>
										</p:dataGrid>
									</div>
								</p:outputPanel>
							</div>
						</div>
					</div>
					
					<!-- Bot√µes do Passo 2 -->
					<div class="step-buttons">
						<p:commandButton value="Anterior" 
							styleClass="btn-step btn-step-previous"
							actionListener="#{agendamentoController.voltaPassosAgendamento()}"
							update="dttDataSelect msgs"
							process="@this"
							immediate="true"
							oncomplete="setTimeout(function(){ PF('dlgAgendar').initPosition(); }, 100);" />
						<p:commandButton id="proximoButtonStep2" styleClass="btn-step btn-step-next total-update" 
							value="Pr√≥ximo"
							update="dttDataSelect msgs"
							process="dttDataSelect" 
							actionListener="#{agendamentoController.addPassosAgendamento()}"
							disabled="#{agendamentoController.proximoDisabled}"
							oncomplete="setTimeout(function(){ PF('dlgAgendar').initPosition(); }, 100);" />
					</div>
				</ui:fragment>
					
				<ui:fragment rendered="#{agendamentoController.passos eq 2}">
					<div class="step-content">
						<div class="step-grid">
							<div class="input-combined step-grid-full">
								<p:outputLabel styleClass="title-input"
									value="Selecione o Hor√°rio" />
								<p:selectOneMenu id="inputHorario"
									value="#{agendamentoController.horaSelecionada}" 
									disabled="#{agendamentoController.agendamentoPassado or empty agendamentoController.horariosDisponiveis}">
									<f:selectItem itemLabel="#{empty agendamentoController.horariosDisponiveis ? 'Nenhum hor√°rio dispon√≠vel' : 'Selecione um hor√°rio'}" itemValue="" />
									<f:selectItems
										value="#{agendamentoController.horariosDisponiveis}" var="h"
										itemLabel="#{h}" itemValue="#{h}" />
									<p:ajax event="change" process="inputHorario" update="btnAgendar btnSalvar" />
								</p:selectOneMenu>
								
								<!-- Mensagem informativa quando n√£o h√° hor√°rios -->
								<h:panelGroup rendered="#{empty agendamentoController.horariosDisponiveis and agendamentoController.dataSelecionada != null}">
									<div class="alert alert-warning mt-2" style="padding: 10px; background: #FFF3CD; border: 1px solid #FFECB5; border-radius: 4px; color: #856404; margin-top: 12px;">
										<i class="fa-solid fa-exclamation-triangle"></i>
										<strong>Aten√ß√£o:</strong> N√£o h√° hor√°rios dispon√≠veis para esta data.
									</div>
								</h:panelGroup>
							</div>
							
							<!-- Campo Sexo: S√ì para agendamentos SEM cadastro -->
							<p:outputPanel id="panelSexo" rendered="#{agendamentoController.tipoCadastro eq 'I'}">
								<div class="input-combined step-grid-full">
									<p:outputLabel styleClass="title-input" value="Sexo *" />
									<p:selectOneMenu id="selectSexo" value="#{agendamentoController.sexoSelecionado}"
										required="#{agendamentoController.tipoCadastro eq 'I'}"
										requiredMessage="O campo Sexo √© obrigat√≥rio">
										<f:selectItem itemLabel="Selecione o sexo" itemValue="" noSelectionOption="true"/>
										<f:selectItem itemLabel="Masculino" itemValue="M" />
										<f:selectItem itemLabel="Feminino" itemValue="F" />
										<f:selectItem itemLabel="N√£o definido" itemValue="O" />
									</p:selectOneMenu>
								</div>
							</p:outputPanel>
							
							<div class="input-combined step-grid-full">
								<p:outputLabel styleClass="title-input" 
									value="Observa√ß√µes (Opcional)" />
								<p:inputTextarea 
									value="#{agendamentoController.observacoes}"
									placeholder="Alguma observa√ß√£o para o atendimento?"
									rows="4"
									maxlength="500" />
							</div>
						</div>
						
						<!-- Bot√µes do Passo 3 -->
						<div class="step-buttons">
							<p:commandButton value="Anterior" 
								styleClass="btn-step btn-step-previous"
								actionListener="#{agendamentoController.voltaPassosAgendamento()}"
								update="dttDataSelect msgs"
								process="@this"
								immediate="true"
								oncomplete="setTimeout(function(){ PF('dlgAgendar').initPosition(); }, 100);" />
							
							<!-- Bot√£o Salvar (quando est√° editando) -->
							<p:commandButton 
								id="btnSalvar"
								value="SALVAR" 
								styleClass="btn-step btn-step-finish"
								actionListener="#{agendamentoController.atualizarAgendamento()}"
								disabled="#{empty agendamentoController.horaSelecionada or agendamentoController.agendamentoPassado}"
								update="dttDataSelect msgs"
								process="dttDataSelect @this"
								rendered="#{agendamentoController.editarModel eq 'A'}" />
							
							<!-- Bot√£o Agendar (quando est√° inserindo) -->
							<p:commandButton 
								id="btnAgendar"
								value="AGENDAR" 
								styleClass="btn-step btn-step-finish"
								actionListener="#{agendamentoController.adicionarNovoAgendamento()}"
								disabled="#{empty agendamentoController.horaSelecionada}"
								update="dttDataSelect msgs"
								process="dttDataSelect @this"
								rendered="#{agendamentoController.editarModel eq 'I'}" />
						</div>
					</div>
				</ui:fragment>
				
			</h:panelGroup>
		</p:dialog>

		<p:dialog id="dlgConfirmCancel" widgetVar="dlgConfirmCancel"
			modal="true" showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<h:panelGroup id="dlgConfirmCancelForm">
				<div class="header-modal-confirm">
					<div>
						<label>Realmente deseja cancelar este Agendamento?</label>
					</div>
				</div>

				<div class="flex align-center justify-center">
					<p:commandButton styleClass="btn medium btn-confirm"
						value="Confirmar"
						actionListener="#{agendamentoController.cancelarAgendamento}"
						update="dttDataSelect"
						process="@this"
						oncomplete="PF('dlgConfirmCancel').hide(); PF('dlgAgendar').hide();" />
					<p:commandButton styleClass="btn medium btn-cancel"
						value="Cancelar" 
						type="button"
						onclick="PF('dlgConfirmCancel').hide()" />
				</div>
			</h:panelGroup>
		</p:dialog>
		<p:dialog id="dlgConfirmEstorno" widgetVar="dlgConfirmEstorno"
			modal="true" showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<h:panelGroup>
				<div class="header-modal-confirm">
					<div>
						<label>Realmente deseja estornar o pagamento e cancelar este Agendamento?</label>
					</div>
				</div>

				<div class="flex align-center justify-center">
					<p:commandButton styleClass="btn medium btn-confirm"
						value="Confirmar" update="form" process="@this"
						actionListener="#{agendamentoController.estornarAgendamento}"
						oncomplete="PF('dlgConfirmEstorno').hide()" />
					<p:commandButton styleClass="btn medium btn-cancel"
						value="Cancelar" onclick="PF('dlgConfirmEstorno').hide()" />
				</div>
			</h:panelGroup>
		</p:dialog>
		
	</ui:define>

	<!-- Conte√∫do da SIDEBAR DIREITA -->
	<ui:define name="sidebar">
		<ui:fragment rendered="#{agendamentoController.agendamentoModel == null or agendamentoController.agendamentoModel.id == null}">
			<div class="sidebar-empty" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 40px 20px; text-align: center;">
				<img class="img-custom" src="#{facesContext.externalContext.requestContextPath}/resources/images/empty-agendamentos.png" 
					style="max-width: 280px; width: 100%; margin-bottom: 32px; opacity: 0.9;" />
				<div style="max-width: 320px;">
					<h3 style="font-family: 'Barlow', sans-serif; font-size: 20px; font-weight: 600; color: #374151; margin: 0 0 12px 0; line-height: 1.4;">
						Selecione um agendamento
					</h3>
					<p style="font-family: 'Barlow', sans-serif; font-size: 14px; font-weight: 400; color: #6B7280; margin: 0; line-height: 1.6;">
						Escolha um agendamento da lista ao lado para visualizar os detalhes completos do cliente e servi√ßos
					</p>
				</div>
			</div>
		</ui:fragment>
	
		<ui:fragment
			rendered="#{agendamentoController.agendamentoModel != null and agendamentoController.agendamentoModel.id != null}">
			<div class="content-logo-system">
				<div class="flex space-between align-center">
					<div class="flex">
						<div class="icon-circle">
							<i class="fa-solid fa-user"></i>
						</div>
						<div class="subtitle-info flex space-between">
							<label class="title-info">Cliente</label>
						</div>
					</div>
					<div class="flex">
						<p:commandButton update="dttDataSelect" process="@this"
							actionListener="#{agendamentoController.editAgendamento()}"
							oncomplete="PF('dlgAgendar').show();"
							class="btn-circle btn-circle-info-lateral"
							icon="fa-solid fa-pen"
							rendered="#{agendamentoController.agendamentoModel.status eq 'A'}" />
						<p:commandButton
							actionListener="#{agendamentoController.fecharCliente()}"
							class="btn-circle btn-circle-info-lateral"
							icon="fa-solid fa-xmark" />
					</div>
				</div>
			</div>
			<div class="content-btns">
				<div class="flex space-between align-center">
					<div class="flex">
					<div class="perfil-top-funcionario mr8"></div>
					<div>
						<label class="title-obj">Cliente</label>
						<ui:fragment
							rendered="#{agendamentoController.agendamentoModel.cliente.id eq null}">
							<label class="subtitle-obj">#{agendamentoController.agendamentoModel.nomeClienteAvulso}</label>
						</ui:fragment>
						<ui:fragment
							rendered="#{agendamentoController.agendamentoModel.cliente.id != null}">
							<label class="subtitle-obj">#{agendamentoController.clienteModel.nome}</label>
						</ui:fragment>
					</div>
				</div>
				
					<p:outputPanel id="attCaixa">
					<div>
						<p:outputLabel class="title-date"
							value="#{agendamentoController.agendamentoModel.dataCriado}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</p:outputLabel>
						<ui:fragment
							rendered="#{agendamentoController.agendamentoModel.status eq 'I' and agendamentoController.agendamentoModel.pago ne 'E'}">
							<p:outputLabel class="title-date" style="background: #C52323"
								value="Cancelado" />
						</ui:fragment>
						<ui:fragment
							rendered="#{agendamentoController.agendamentoModel.status eq 'A'}">
							<p:outputLabel class="title-date" style="background: #FFC107 "
								value="Pendente" />
						</ui:fragment>
						<ui:fragment
							rendered="#{agendamentoController.agendamentoModel.status eq 'F'}">
							<p:outputLabel class="title-date" style="background: #23C538"
								value="Finalizado" />
						</ui:fragment>
						<ui:fragment
							rendered="#{agendamentoController.agendamentoModel.pago eq 'E'}">
							<p:outputLabel class="title-date" style="background: #6c757d;"
								value="Estornado" />
						</ui:fragment>
					</div>
				</p:outputPanel>
				</div>
				
				

				<div>
				
				<div class="content-info-cliente">
				
						<!-- Sexo do Cliente (L√≥gica Unificada) -->
				<ui:fragment rendered="#{(agendamentoController.agendamentoModel.cliente.id != null and agendamentoController.clienteModel.sexo != null) or (agendamentoController.agendamentoModel.cliente.id == null and agendamentoController.agendamentoModel.sexo != null)}">
					<div class="content-card-info-cliente" style="padding-top: 8px;">
						<label class="title-obj">Sexo</label>
						<label class="subtitle-obj">
							<!-- Determina qual campo de sexo usar -->
							#{agendamentoController.agendamentoModel.cliente.id != null ? 
							  (agendamentoController.clienteModel.sexo eq 'M' ? 'Masculino' : (agendamentoController.clienteModel.sexo eq 'F' ? 'Feminino' : 'Outro')) :
							  (agendamentoController.agendamentoModel.sexo eq 'M' ? 'Masculino' : (agendamentoController.agendamentoModel.sexo eq 'F' ? 'Feminino' : 'Outro'))
							}
						</label>
					</div>
				</ui:fragment>
					<!-- Observa√ß√µes do Cliente (prioridade: agendamento > cadastro) -->
				<ui:fragment rendered="#{(agendamentoController.agendamentoModel.observacoes != null and agendamentoController.agendamentoModel.observacoes.trim() != '') or (agendamentoController.agendamentoModel.cliente.id != null and agendamentoController.clienteModel.observacoes != null and agendamentoController.clienteModel.observacoes.trim() != '')}">
					<div class="content-card-info-cliente" style="padding-top: 8px;">
						<label class="title-obj">Observa√ß√µes/Prefer√™ncias</label>
						<label class="subtitle-obj">
							#{agendamentoController.agendamentoModel.observacoes != null and agendamentoController.agendamentoModel.observacoes.trim() != '' ? agendamentoController.agendamentoModel.observacoes : agendamentoController.clienteModel.observacoes}
						</label>
					</div>
				</ui:fragment>
				
				
				</div>
				
				</div>
			</div>
			<div class="content-valores">
				<label class="title-obj">Funcion√°rio a realizar servi√ßos</label> <label
					class="subtitle-obj">#{agendamentoController.agendamentoModel.funcionario.nome}</label>
			</div>
			<div class="content-agendamentos flex column space-between">
				<div>
					<label class="title-servicos mb15">Servi√ßos contratados</label>
					<p:dataList id="dttlstservicos" rows="4"
						class="dataList-dialog-custom data-list-time services-scroll"
						value="#{agendamentoController.agendamentoModel.servicos}"
						var="servico" rowIndexVar="index">
						<div class="list-time">
							<div>
								<i class="fa-solid fa-scissors"></i>
								<div>
									<label class="title-obj uppercase">#{servico.nome}</label> <label
										class="subtitle-obj"> <h:outputText
											value="#{servico.preco}">
											<f:convertNumber type="currency" currencySymbol="R$"
												maxFractionDigits="2" />
										</h:outputText>
									</label>
								</div>
							</div>
						</div>
					</p:dataList>
				</div>

				<div>
					<div class="fundo-valores-totais">
						<label>Total</label> <label> <h:outputText
								value="#{agendamentoController.totalGastoServicos}">
								<f:convertNumber type="currency" currencySymbol="R$"
									maxFractionDigits="2" />
							</h:outputText>
						</label>
					</div>

					<p:outputPanel id="painelAcoes">
						<ui:fragment
							rendered="#{agendamentoController.agendamentoModel.pago ne 'S' and agendamentoController.agendamentoModel.status ne 'I'}">
							<div class="input-combined">
								<p:outputLabel class="title-input" value="M√©todo de pagamento" />
								<p:selectOneMenu value="#{agendamentoController.idPagamento}">
									<f:selectItem itemLabel="Selecione forma de pagamento"
										itemValue="" noSelectionOption="false" />
									<f:selectItems value="#{agendamentoController.lstPagamento}"
										var="pag" itemLabel="#{pag.nome}" itemValue="#{pag.id}" />
									<p:ajax update="@form" process="@this" />
								</p:selectOneMenu>
							</div>
						</ui:fragment>

						<div class="fundo-btns">
							<ui:fragment
								rendered="#{agendamentoController.agendamentoModel.pago ne 'S' and agendamentoController.agendamentoModel.status ne 'I'}">
								<p:commandButton
									actionListener="#{agendamentoController.confirmaPagamentoPedido()}"
									class="btn btn-green" value="Confirmar pagamento"
									update="form:attCaixa form:painelAcoes" process="@form" />
							</ui:fragment>

							<p:commandButton
							    value="Estornar"
							    styleClass="btn btn-danger medium"
							    onclick="PF('dlgConfirmEstorno').show()"
							    process="@this"
							    rendered="#{agendamentoController.agendamentoModel.pago eq 'S' and agendamentoController.agendamentoModel.status eq 'A' and agendamentoController.agendamentoModel.pagamento != null}" />

							<p:commandButton
								actionListener="#{agendamentoController.finalizarPedido()}"
								class="btn btn-blue medium" value="Finalizar" update="@form"
								process="@this"
								rendered="#{agendamentoController.agendamentoModel.status eq 'A' and agendamentoController.agendamentoModel.pago eq 'S' and agendamentoController.podeFinalizarHoje}" />
						</div>
					</p:outputPanel>
				</div>
			</div>
		</ui:fragment>
	</ui:define>

</ui:composition>
</html>