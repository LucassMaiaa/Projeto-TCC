<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <title>BarberSys</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/css/global.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
        <h:outputScript library="primefaces" name="locales/locale-pt.js" />
    </h:head>

    <h:body>
        
        <style>          
            .content-agendamentos{
                border-radius: 0px;
                height: 100vh;
                max-height: calc(100vh - 354px);
                padding: 15px 20px 30px;
            }
            
            .content-info-lateral {
                background: #FCFCFF;
            }
            
            .content-valores {
                height: 204px;
            }
            
           body .ui-datatable thead tr:not(.ui-datatable-empty-message),
           body .ui-datatable tbody tr:not(.ui-datatable-empty-message){
                display: grid;
                grid-template-columns: 62px 150px 110px 70px 1fr;
            }
            
            body .ui-datatable thead th:first-child:not(.ui-datatable-empty-message),
            body .ui-datatable tbody td:first-child:not(.ui-datatable-empty-message){
                text-align: center !important;
            }
            
            body .ui-dialog:has( .header-modal) .ui-dialog-content {
			    padding: 20px;
			    width: 400px;
			    min-width: 400px !important;
			}
            
        </style>    
        
        <h:form id="form" styleClass="main"> 
             <div class="grid-content">
                 
                 <ui:include src="menu_lateral.xhtml"></ui:include>
                 <div class="content-dashboard">
                     <div class="content-perfil flex space-between">
                         <div class="flex align-center">
                             <div class="avatar-circle btn-circle mr8">
                                 
                             </div>
                             
                             <div class="content-title-perfil">
                                 <h:outputText class="title-welcome-perfil" value="Olá" />
                                 <h:outputText class="title-name-perfil" value="#{usuarioController.login}" />
                             </div>
                         </div>
                         <div class="flex">
                             <p:commandButton class="btn-circle"  icon="fa-solid fa-bell" />
                             
                             <p:commandButton class="btn-sair-header" value="Sair" icon="fa-solid fa-right-from-bracket" />
                         </div>
                     </div>
                     
                     <div class="flex space-between">
                             <p:outputLabel class="title-page" value="Extrato do caixa" />
                     </div>
                     
                     <div class="header-filters">
                           <div class="content-filter ">
                               <i class="fa-solid fa-filter"></i>
                               <p:selectOneButton value="#{controleCaixaController.filtroTipoDeValor}" unselectable="false">
                                    <f:selectItem itemLabel="Todos" itemValue="" />
                                    <f:selectItem itemLabel="Entradas" itemValue="Entrada" />
                                    <f:selectItem itemLabel="Saídas" itemValue="Saida" />
                                    <p:ajax update="@form" process="@this"/>
                                </p:selectOneButton>
                            </div>
                     </div>
                     
                     <div>
                         <p:dataTable id="datatableCaixas" rowIndexVar="row" class="data-table-info" value="#{controleCaixaController.lstControleCaixa}" var="caixa"
                                      paginator="true" paginatorPosition="bottom" rows="13" lazy="true" emptyMessage="Nenhum dado encontrado">
                             
                            <p:column headerText="Código">
                                  <h:outputText value="#{row + 1}" />
                            </p:column>
                             
                             <p:column headerText="Movimentação">
                                <h:outputText value="#{caixa.movimentacao}" />
                            </p:column>
                             
                            <p:column headerText="Valor">
                                <h:outputText value="#{caixa.valor}">
                                    <f:convertNumber type="currency" currencySymbol="R$" locale="pt_BR" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Hora">
                                <h:outputText value="#{caixa.horaAtual.substring(0,5)}"/>
                            </p:column>

                            <p:column headerText="Motivo">
                                <h:outputText value="#{caixa.motivo}" />
                            </p:column>

                            
                             
                         </p:dataTable>
                     </div>

                 </div>
                 <div class="content-info-lateral">
                     <div class="content-logo-system">
                         <div class="flex">
                                <div class="icon-circle">
                                    <i class="fa-solid fa-money-bills"></i>
                                </div>
                                <div class="subtitle-info">
                                    <label class="title-info">Controle de Caixa</label>
                                </div>
                            </div>
                     </div>
                     <div class="content-btns">
                         <p:selectOneButton disabled="#{controleCaixaController.chaveCaixa}" id="attBtnCaixa" value="#{controleCaixaController.statusSelecionado}" unselectable="false">
                            <f:selectItem itemLabel="Aberto" itemValue="A" />
                             <f:selectItem itemLabel="Fechado" itemValue="I" />   
                             <p:ajax update="@form" process="@this"  listener="#{controleCaixaController.verificaTravaCampo()}" oncomplete="if (args.aberto) PF('dlgSaldo').show();"/>
                         </p:selectOneButton>
                         
                         <p:outputPanel id="attCaixa">
                             <div>
                                 <p:outputLabel class="title-date" value="#{controleCaixaController.dataSelecionada}">
                                     <f:convertDateTime pattern="dd/MM/yyyy" />
                                 </p:outputLabel>
                                 <ui:fragment rendered="#{controleCaixaController.statusSelecionado eq 'I'}" >
                                     <p:outputLabel class="title-date" style="background: #C52323" 
                                               value="Fechado" />
                                 </ui:fragment>
                                 <ui:fragment rendered="#{controleCaixaController.statusSelecionado eq 'A'}" >
                                     <p:outputLabel class="title-date" style="background: #23C538 " 
                                               value="Aberto" />
                                 </ui:fragment>
                                
                            </div>
                         </p:outputPanel>
                         
                     </div>
                     <div class="content-valores">
                     	<h:panelGroup id="vlrCaixa">
                     		<div class="input-combined input-valores">
	                         	<div class="row">
	                                 <div class="col-md-6">
	                                     <p:outputLabel class="title-input" value="Caixa Inicial do dia"/>
	                                     <p:inputNumber  symbol="R$ " value="#{controleCaixaController.valorInicial}" readonly="true"/>
	                                 </div>
	                                 <div class="col-md-6">
	                                     <p:outputLabel class="title-input" value="Caixa Final do dia"/>
	                                     <p:inputNumber symbol="R$ " value="#{controleCaixaController.valorFinal}" readonly="true"/>
	                                 </div>
	                             </div>
	                         
	                             <div class="row">
	                                 <div class="col-md-6">
	                                     <p:outputLabel class="title-input" value="Total de entradas no dia"/>
	                                     <p:inputNumber  symbol="R$ " value="#{controleCaixaController.totalEntradas}" readonly="true"/>
	                                 </div>
	                                 <div class="col-md-6">
	                                     <p:outputLabel class="title-input" value="Total de saídas no dia"/>
	                                     <p:inputNumber symbol="R$ " value="#{controleCaixaController.totalSaidas}" readonly="true"/>
	                                 </div>
	                             </div>
	                             
	                             <div class="row">
	                                 <div class="col-md-6">
	                                     <p:outputLabel class="title-input" value="Total de entradas no mês"/>
	                                     <p:inputNumber  symbol="R$ " value="#{controleCaixaController.totalEntradasMes}" readonly="true"/>
	                                 </div>
	                                 <div class="col-md-6">
	                                     <p:outputLabel class="title-input" value="Total de saídas no mês"/>
	                                     <p:inputNumber symbol="R$ " value="#{controleCaixaController.totalSaidasMes}" readonly="true"/>
	                                 </div>
	                             </div>
	                            
	                         </div>
                     	</h:panelGroup>
                         
                     </div>
                     <div class="content-agendamentos flex column space-between">
                         <div>
                             <div class="select-segundario no-filter">
                                <p:selectOneButton value="#{controleCaixaController.tipodeValor}" unselectable="false">
                                   <f:selectItem itemLabel="Entrada" itemValue="e" />
                                    <f:selectItem itemLabel="Saída" itemValue="s" />   
                                    <p:ajax update="@form" process="@this"/>
                                </p:selectOneButton>
                            </div>
                             
                             <p:growl/>
                            <div class="row">
                                <div class="col-md-6">
                                    <ui:fragment rendered="#{controleCaixaController.tipodeValor eq 'e'}">
                                        <div class="input-combined">
                                           <p:outputLabel class="title-input" value="Valor de entrada" />
                                           <p:inputNumber symbol="R$ " value="#{controleCaixaController.controleCaixaModel.valor}" 
                                                          disabled="#{controleCaixaController.dadosLiberados}" required="true" requiredMessage="Preencha o campo de valor"/>
                                       </div>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{controleCaixaController.tipodeValor eq 's'}" >
                                        <div class="input-combined">
                                           <p:outputLabel class="title-input" value="Valor de saída" />
                                           <p:inputNumber symbol="R$ " value="#{controleCaixaController.controleCaixaModel.valor}" 
                                                          disabled="#{controleCaixaController.dadosLiberados}" required="true" requiredMessage="Preencha o campo de valor" />
                                       </div>
                                    </ui:fragment>
                                </div>
                                <div class="col-md-6">
                                    <div class="input-combined">
                                         <p:outputLabel class="title-input" value="Data do caixa" />
                                         <p:datePicker showIcon="true" value="#{controleCaixaController.dataSelecionada}" pattern="dd/MM/yyyy">
                                             <p:ajax update="@form" process="@this" listener="#{controleCaixaController.verificaData}"/>
                                         </p:datePicker>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="input-combined">
                                        <p:outputLabel class="title-input" value="Motivo"/>
                                        <p:inputTextarea maxlength="100" value="#{controleCaixaController.controleCaixaModel.motivo}" disabled="#{controleCaixaController.dadosLiberados}"/>
                                    </div>
                                </div>
                            </div>
                         </div>
                         
                         
                         <div class="flex justify-center">
                             <p:commandButton class="btn btn-blue medium" value="Registrar" update="@form" process="@form" actionListener="#{controleCaixaController.salvarValores()}" />
                         </div>
                         
                     </div>
                 </div>
             </div>
             
             <p:dialog id="dlgSaldo" widgetVar="dlgSaldo" modal="true" showEffect="fade" hideEffect="fade" closable="false" draggable="false" resizable="false">
                 <div class="header-modal">
                 	<div class="flex align-center">
                 		<div class="icon-circle">
	                         <i class="fa-solid fa-calendar-days"></i>
	                     </div>
	                     <p:outputLabel value="#{controleCaixaController.statusSelecionado eq 'A' ? 'Valor Inicial do Caixa' : 'Valor Final do Caixa'}" />
                 	</div>
                 </div>
                 
                 <h:panelGroup id="dialogVlr">
                 	<div class="row">
	                     <div class="col-md-12">
	                     	<ui:fragment rendered="#{controleCaixaController.statusSelecionado eq 'A'}">
	                     		<div class="input-combined">
	                              <p:outputLabel class="title-input" value="Valor Inicial" />
	                              <p:inputNumber symbol="R$ " value="#{controleCaixaController.valorInicial}" 
	                                             required="true" requiredMessage="Preencha o campo de valor" />
	                          	</div>
	                     	</ui:fragment>
	                     	
	                     	<ui:fragment rendered="#{controleCaixaController.statusSelecionado eq 'I'}">
	                     		<div class="input-combined">
	                              <p:outputLabel class="title-input" value="Valor Final" />
	                              <p:inputNumber symbol="R$ " value="#{controleCaixaController.valorFinal}" 
	                                             required="true" requiredMessage="Preencha o campo de valor" />
	                          	</div>
	                     	</ui:fragment>
	                     </div>
	                 </div>
	                 
	                 <ui:fragment rendered="#{controleCaixaController.motivoFinal eq 'A'}">
	                 	<div class="row">
		                     <div class="col-md-12">
		                         <div class="input-combined">
		                             <p:outputLabel class="title-input" value="Valor final menor que o inicial informe o motivo"/>
		                             <p:inputTextarea maxlength="100" required="true" value="#{controleCaixaController.mensagemMotivoFinal}"/>
		                         </div>
		                     </div>
		                 </div>
	                 </ui:fragment>
                 </h:panelGroup>
                 
                  <div class="flex justify-center mt15">
                  	<ui:fragment rendered="#{controleCaixaController.statusSelecionado eq 'A'}">
                  		<p:commandButton class="btn btn-blue medium" value="Registrar" update="@form" process="dlgSaldo" actionListener="#{controleCaixaController.salvarRegistroInicial()}" />
                  	</ui:fragment>
                  	<ui:fragment rendered="#{controleCaixaController.statusSelecionado eq 'I'}">
                  		<p:commandButton class="btn btn-blue medium" value="Registrar"
                  		 update="datatableCaixas vlrCaixa dialogVlr" process="@this" 
                  		 actionListener="#{controleCaixaController.salvarRegistroFinal()}"
                  		 oncomplete="if (!args.mostrarMotivo) PF('dlgSaldo').hide();" />
                  	</ui:fragment>
                      
                  </div>
                 
            </p:dialog>
             
        </h:form>
        
    </h:body>
</html>

