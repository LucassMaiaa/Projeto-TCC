<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<!-- Usando o template com sidebar -->
<ui:composition template="/WEB-INF/template-with-sidebar.xhtml">

	<!-- Título da página -->
	<ui:define name="title">Controle de Caixa - BarberSys</ui:define>
	
	<!-- CSS específico desta página -->
	<ui:define name="extra-css">
		<h:outputScript library="primefaces" name="locales/locale-pt.js" />
		<style>
.content-agendamentos {
	border-radius: 0px;
	height: 100vh;
	max-height: calc(100vh - 354px);
	padding: 15px 20px 30px;
}

.content-info-lateral {
	background: #FCFCFF;
}

.content-valores {
	height: 204px;
}

body .ui-datatable thead tr:not(.ui-datatable-empty-message), body .ui-datatable tbody tr:not(.ui-datatable-empty-message)
	{
	display: grid;
	grid-template-columns: 62px 150px 110px 70px 1fr;
}

body .ui-datatable thead th:first-child:not(.ui-datatable-empty-message),
	body .ui-datatable tbody td:first-child:not(.ui-datatable-empty-message)
	{
	text-align: center !important;
}

body .ui-dialog:has( .header-modal) .ui-dialog-content {
	padding: 20px;
	width: 400px;
	min-width: 400px !important;
}
		</style>
	</ui:define>

	<!-- Conteúdo CENTRAL da página -->
	<ui:define name="content">
	
		<!-- Título da página -->
		<div class="flex space-between">
			<p:outputLabel class="title-page" value="Extrato do caixa" />
		</div>

		<!-- Filtros -->
		<div class="header-filters">
			<div class="row">
				<div class="col-md-4">
					<div class="content-filter ">
						<i class="fa-solid fa-filter"></i>
						<p:selectOneButton
							value="#{controleCaixaController.filtroTipoDeValor}"
							unselectable="false">
							<f:selectItem itemLabel="Todos" itemValue="" />
							<f:selectItem itemLabel="Entradas" itemValue="Entrada" />
							<f:selectItem itemLabel="Saídas" itemValue="Saida" />
							<p:ajax update="@form" process="@this" />
						</p:selectOneButton>
					</div>
				</div>
			</div>
		</div>

		<!-- Tabela de dados -->
		<div>
			<p:dataTable id="datatableCaixas" rowIndexVar="row"
				class="data-table-info"
				value="#{controleCaixaController.lstControleCaixa}" var="caixa"
				paginator="true" paginatorPosition="bottom" rows="13" lazy="true"
				emptyMessage="Nenhum dado encontrado">

				<p:column headerText="Código">
					<h:outputText value="#{row + 1}" />
				</p:column>

				<p:column headerText="Movimentação">
					<h:outputText value="#{caixa.movimentacao}" />
				</p:column>

				<p:column headerText="Valores/Lucros">
					<h:outputText value="#{caixa.valor}">
						<f:convertNumber type="currency" currencySymbol="R$"
							locale="pt_BR" />
					</h:outputText>
				</p:column>

				<p:column headerText="Hora">
					<h:outputText value="#{caixa.horaAtual.substring(0,5)}" />
				</p:column>

				<p:column headerText="Motivo">
					<h:outputText value="#{caixa.motivo}" />
				</p:column>

			</p:dataTable>
		</div>
		
	</ui:define>

	<!-- Conteúdo da SIDEBAR DIREITA -->
	<ui:define name="sidebar">
				<div class="content-logo-system">
					<div class="flex">
						<div class="icon-circle">
							<i class="fa-solid fa-money-bills"></i>
						</div>
						<div class="subtitle-info">
							<label class="title-info">Controle de Caixa</label>
						</div>
					</div>
				</div>
				<div class="content-btns">
					<p:selectOneButton disabled="#{controleCaixaController.chaveCaixa}"
						id="attBtnCaixa"
						value="#{controleCaixaController.statusSelecionado}"
						unselectable="false">
						<f:selectItem itemLabel="Aberto" itemValue="A" />
						<f:selectItem itemLabel="Fechado" itemValue="I" />
						<p:ajax update="@form" process="@this"
							listener="#{controleCaixaController.verificaTravaCampo()}"
							oncomplete="if (args.aberto) PF('dlgSaldo').show();" />
					</p:selectOneButton>

					<p:outputPanel id="attCaixa">
						<div>
							<p:outputLabel class="title-date"
								value="#{controleCaixaController.dataSelecionada}">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</p:outputLabel>
							<ui:fragment
								rendered="#{controleCaixaController.statusSelecionado eq 'I'}">
								<p:outputLabel class="title-date" style="background: #C52323"
									value="Fechado" />
							</ui:fragment>
							<ui:fragment
								rendered="#{controleCaixaController.statusSelecionado eq 'A'}">
								<p:outputLabel class="title-date" style="background: #23C538 "
									value="Aberto" />
							</ui:fragment>

						</div>
					</p:outputPanel>

				</div>
				<div class="content-valores">
					<h:panelGroup id="vlrCaixa">
						<div class="input-combined input-valores">
							<div class="row">
								<div class="col-md-6">
									<p:outputLabel class="title-input" value="Caixa inicial" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.valorInicial}"
										readonly="true" />
								</div>
								<div class="col-md-6">
									<p:outputLabel class="title-input" value="Caixa Final" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.valorFinal}" readonly="true" />
								</div>
							</div>

							<div class="row">
								<div class="col-md-6">
									<p:outputLabel class="title-input"
										value="Total de entradas no dia" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.totalEntradas}"
										readonly="true" />
								</div>
								<div class="col-md-6">
									<p:outputLabel class="title-input"
										value="Total de saídas no dia" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.totalSaidas}" readonly="true" />
								</div>
							</div>

							<div class="row">
								<div class="col-md-6">
									<p:outputLabel class="title-input"
										value="Total de entradas no mês" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.totalEntradasMes}"
										readonly="true" />
								</div>
								<div class="col-md-6">
									<p:outputLabel class="title-input"
										value="Total de saídas no mês" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.totalSaidasMes}"
										readonly="true" />
								</div>
							</div>

						</div>
					</h:panelGroup>

				</div>
			<div class="content-agendamentos flex column space-between">
				<div>
					<div class="select-segundario no-filter">
						<p:selectOneButton value="#{controleCaixaController.tipodeValor}"
							unselectable="false">
							<f:selectItem itemLabel="Entrada" itemValue="e" />
							<f:selectItem itemLabel="Saída" itemValue="s" />
							<p:ajax update="@form" process="@this" />
						</p:selectOneButton>
					</div>

					<p:growl />
					<div class="row">
						<div class="col-md-6">
							<ui:fragment
								rendered="#{controleCaixaController.tipodeValor eq 'e'}">
								<div class="input-combined">
									<p:outputLabel class="title-input" value="Valor de entrada" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.controleCaixaModel.valor}"
										disabled="#{controleCaixaController.dadosLiberados}"
										required="true"
										requiredMessage="Preencha o campo de valor de entrada" />
								</div>
							</ui:fragment>
							<ui:fragment
								rendered="#{controleCaixaController.tipodeValor eq 's'}">
								<div class="input-combined">
									<p:outputLabel class="title-input" value="Valor de saída" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.controleCaixaModel.valor}"
										disabled="#{controleCaixaController.dadosLiberados}"
										required="true"
										requiredMessage="Preencha o campo de valor vazamento" />
								</div>
							</ui:fragment>
						</div>
						<div class="col-md-6">
							<div class="input-combined">
								<p:outputLabel class="title-input" value="Data do caixa" />
								<p:datePicker showIcon="true"
									value="#{controleCaixaController.dataSelecionada}"
									pattern="dd/MM/yyyy">
									<p:ajax update="@form" process="@this"
										listener="#{controleCaixaController.verificaData}" />
								</p:datePicker>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="input-combined">
								<p:outputLabel class="title-input" value="Motivo" />
								<p:inputTextarea maxlength="100"
									value="#{controleCaixaController.controleCaixaModel.motivo}"
									disabled="#{controleCaixaController.dadosLiberados}" />
							</div>
						</div>
					</div>
				</div>

				<div class="flex justify-center">
					<p:commandButton
						disabled="#{controleCaixaController.dadosLiberados}"
						class="btn btn-blue medium" value="Registrar" update="@form"
						process="@form"
						actionListener="#{controleCaixaController.salvarValores()}" />
				</div>
			</div>
			
			<!-- Modal de Saldo -->
			<p:dialog id="dlgSaldo" widgetVar="dlgSaldo" modal="true"
				showEffect="fade" hideEffect="fade" closable="false"
				draggable="false" resizable="false">
				<div class="header-modal">
					<div class="flex align-center">
						<div class="icon-circle">
							<i class="fa-solid fa-money-bill-transfer"></i>
						</div>
						<label>
							#{controleCaixaController.statusSelecionado eq 'A' ? 'Valor Inicial do Caixa' : 'Valor Final do Caixa'}
						</label>
					</div>
				</div>
				<p:messages id="messages" showDetail="true" autoUpdate="true"
					closable="true" />

				<h:panelGroup id="dialogVlr">
					<div class="row">
						<div class="col-md-12">
							<ui:fragment
								rendered="#{controleCaixaController.statusSelecionado eq 'A'}">
								<div class="input-combined">
									<p:outputLabel class="title-input" value="Valor Inicial" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.valorInicial}" required="true"
										requiredMessage="Preencha o campo de valor" />
								</div>
							</ui:fragment>

							<ui:fragment
								rendered="#{controleCaixaController.statusSelecionado eq 'I'}">
								<div class="flex justify-end">
									<span class="desc-topo">Cálculo Automático: <span
										class="desc-topo-segundary">R$
											#{controleCaixaController.valorSugerido}</span></span>
								</div>

								<div class="input-combined">
									<p:outputLabel class="title-input" value="Valor Final" />
									<p:inputNumber symbol="R$ "
										value="#{controleCaixaController.valorFinal}" required="true"
										requiredMessage="Preencha o campo de valor" />
								</div>
							</ui:fragment>
						</div>
					</div>

					<ui:fragment
						rendered="#{controleCaixaController.statusSelecionado eq 'I'}">
						<div class="row">
							<div class="col-md-12">
								<div class="input-combined">
									<p:outputLabel class="title-input"
										value="#{controleCaixaController.motivoFinal eq 'A' ? 'Valor final menor que o inicial informe o motivo' : 'Motivo'}" />
									<p:inputTextarea maxlength="100"
										value="#{controleCaixaController.mensagemMotivoFinal}" />
								</div>
							</div>
						</div>
					</ui:fragment>

				</h:panelGroup>

				<div class="flex justify-center mt15">
					<ui:fragment
						rendered="#{controleCaixaController.statusSelecionado eq 'A'}">
						<p:commandButton class="btn btn-blue medium" value="Registrar"
							update="@form" process="dlgSaldo"
							actionListener="#{controleCaixaController.salvarRegistroInicial()}" />
					</ui:fragment>
					<ui:fragment
						rendered="#{controleCaixaController.statusSelecionado eq 'I'}">
						<p:commandButton class="btn btn-blue medium" value="Registrar"
							update="datatableCaixas vlrCaixa dialogVlr messages"
							process="dlgSaldo"
							actionListener="#{controleCaixaController.salvarRegistroFinal()}"
							oncomplete="if (args.validado) PF('dlgSaldo').hide();" />
					</ui:fragment>
				</div>

			</p:dialog>
		
	</ui:define>

</ui:composition>
</html>