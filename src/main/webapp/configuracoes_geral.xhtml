<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<!-- Usando o template SEM sidebar (full width) -->
<ui:composition template="/WEB-INF/template.xhtml">

	<!-- Título da página -->
	<ui:define name="title">Configurações Gerais - BarberSys</ui:define>
	
	<!-- CSS específico desta página -->
	<ui:define name="extra-css">
		<style>
			:root { --avatar-color: #23A4D5; }

			.config-container {
				background: #FFFFFF;
				border-radius: 12px;
				padding: 40px;
				box-shadow: 0 3px 6px #00000029;
				max-width: 1200px;
				margin: 0 auto;
				animation: fadeInUp 0.5s ease-out;
			}

			.avatar-section {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 15px;
				margin-bottom: 35px;
				padding-bottom: 30px;
				border-bottom: 1px solid #EBEBEB;
			}

			.avatar-circle-large {
				width: 120px;
				height: 120px;
				border-radius: 50%;
				background: var(--avatar-color, #23A4D5);
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.avatar-circle-large i {
				font-size: 50px;
				color: white;
			}

			.avatar-info {
				text-align: center;
			}

			.avatar-name {
				font-size: 24px;
				font-weight: 700;
				color: #1F2937;
				margin-bottom: 5px;
				text-transform: uppercase;
			}

			.avatar-role {
				font-size: 14px;
				color: #6B7280;
				font-weight: 600;
				background-color: #f0f0f0;
				padding: 4px 12px;
				border-radius: 12px;
			}

			.section-divider {
				display: flex;
				align-items: center;
				gap: 12px;
				margin: 35px 0 25px 0;
				padding-bottom: 12px;
				border-bottom: 1px solid #EBEBEB;
			}

			.section-divider i {
				font-size: 22px;
				color: #23A4D5;
			}

			.section-divider h3 {
				margin: 0;
				font-size: 18px;
				font-weight: 700;
				color: #374151;
			}

			.checkbox-container {
				display: flex;
				align-items: center;
				gap: 10px;
				margin-bottom: 20px;
			}

			.checkbox-container label {
				font-weight: 600;
				color: #374151;
				cursor: pointer;
				user-select: none;
			}

			.action-buttons {
				display: flex;
				justify-content: center;
				gap: 15px;
				margin-top: 40px;
				padding-top: 25px;
				border-top: 1px solid #EBEBEB;
			}

			@keyframes fadeInUp {
				from { opacity: 0; transform: translateY(20px); }
				to { opacity: 1; transform: translateY(0); }
			}
			
			body .ui-chkbox .ui-chkbox-box .ui-chkbox-icon {
				overflow: visible;
				position: absolute;
				left: 50%;
				top: 50%;
				margin-left: -0.5rem;
				margin-top: -0.5rem;
				transform: translate(-2%, -17%);
			}
		</style>
		
		<script type="text/javascript">
			function definirCorAvatar() {
				var perfil = '#{configuracaoGeralController.usuarioModel.perfil.id}';
                var cor = '#6366F1';
                
                if (perfil === '1') cor = '#23A4D5'; // Admin
                else if (perfil === '2') cor = '#E74A46'; // Funcionario
				
				document.documentElement.style.setProperty('--avatar-color', cor);
			}
			
			function toggleSenha() {
				var container = document.getElementById('senhaFieldsContainer');
				if (container.style.display === 'none' || container.style.display === '') {
					container.style.display = 'block';
				} else {
					container.style.display = 'none';
				}
			}
			
			window.onload = function() {
				definirCorAvatar();
			};
		</script>
	</ui:define>

	<!-- Conteúdo da página -->
	<ui:define name="content">
		<h:form id="formConfig">
			<p:messages id="messages" showDetail="true" closable="true" />
			
			<div class="config-container">
				<!-- Avatar e informações do usuário -->
				<div class="avatar-section">
					<div class="avatar-circle-large">
						<i class="fa-solid #{configuracaoGeralController.iconeAvatar}"></i>
					</div>
					<div class="avatar-info">
						<div class="avatar-name">#{configuracaoGeralController.nomeUsuario}</div>
						<div class="avatar-role">#{configuracaoGeralController.tipoPerfil}</div>
					</div>
				</div>
				
				<!-- Seção: Dados Pessoais -->
				<div class="section-divider">
					<i class="fa-solid fa-user-gear"></i>
					<h3>Dados Gerais</h3>
				</div>
				
				<!-- Campos para ADMIN -->
				<c:if test="#{configuracaoGeralController.adminPerfil}">
					<div class="row">
                        <div class="col-md-6">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Nome de Usuário *"/>
                                <p:inputText id="nomeUsuario" value="#{configuracaoGeralController.nomeUsuario}"
                                             required="true" maxlength="100"
                                             requiredMessage="Nome de usuário é obrigatório" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Email *"/>
                                <p:inputText id="emailUsuario" value="#{configuracaoGeralController.loginUsuario}"
                                             required="true" maxlength="100"
                                             requiredMessage="Email é obrigatório"
                                             validatorMessage="Email inválido">
                                    <f:validateRegex pattern="^[A-Za-z0-9+_.-]+@(.+)$"/>
                                </p:inputText>
                            </div>
                        </div>
                    </div>
				</c:if>

				<!-- Campos para FUNCIONARIO -->
				<c:if test="#{configuracaoGeralController.funcionarioPerfil}">
					<div class="row">
                        <div class="col-md-6">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Nome de Usuário *"/>
                                <p:inputText id="nomeUsuarioFunc" value="#{configuracaoGeralController.nomeUsuario}"
                                             required="true" maxlength="100"
                                             requiredMessage="Nome de usuário é obrigatório" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Nome Completo *"/>
                                <p:inputText id="nomeFunc" value="#{configuracaoGeralController.funcionarioModel.nome}"
                                             required="true" maxlength="100"
                                             requiredMessage="Nome completo é obrigatório" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                    	<div class="col-md-12">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Email *"/>
                                <p:inputText id="emailSecundario" placeholder="email@secundario.com"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="CPF *"/>
                                <p:inputMask id="cpfFunc" value="#{configuracaoGeralController.funcionarioModel.cpf}"
                                             mask="999.999.999-99"
                                             disabled="true" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Telefone *"/>
                                <p:inputMask id="telefoneFunc" value="#{configuracaoGeralController.funcionarioModel.telefone}"
                                             mask="(99) 99999-9999"
                                             required="true"
                                             requiredMessage="Telefone é obrigatório" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Sexo *" />
								<p:selectOneMenu id="sexoFunc" value="#{configuracaoGeralController.funcionarioModel.sexo}"
																 required="true"
																 requiredMessage="Sexo é obrigatório">
									<f:selectItem itemLabel="Selecione" itemValue=""/>
									<f:selectItem itemLabel="Masculino" itemValue="M"/>
									<f:selectItem itemLabel="Feminino" itemValue="F"/>
									<f:selectItem itemLabel="Outro" itemValue="O"/>
								</p:selectOneMenu>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                             <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Data de Nascimento *"/>
                                <p:datePicker id="dataNascFunc" value="#{configuracaoGeralController.funcionarioModel.dataNascimento}"
                                            pattern="dd/MM/yyyy"
                                            disabled="true"
                                            showIcon="true"/>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ENDERECO DO FUNCIONARIO -->
                    <div class="section-divider">
                        <i class="fa-solid fa-map-marker-alt"></i>
                        <h3>Endereço</h3>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="CEP *"/>
                                <p:inputMask id="cepFunc" value="#{configuracaoGeralController.funcionarioModel.cep}"
                                             mask="99999-999" required="true"
                                             requiredMessage="CEP é obrigatório"/>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Cidade *"/>
                                <p:inputText id="cidadeFunc" value="#{configuracaoGeralController.funcionarioModel.cidade}"
                                             required="true" requiredMessage="Cidade é obrigatória"/>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="UF *"/>
                                <p:inputText id="ufFunc" value="#{configuracaoGeralController.funcionarioModel.estado}"
                                             maxlength="2" required="true" requiredMessage="UF é obrigatório"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Rua *"/>
                                <p:inputText id="ruaFunc" value="#{configuracaoGeralController.funcionarioModel.rua}"
                                             required="true" requiredMessage="Rua é obrigatória"/>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Número *"/>
                                <p:inputText id="numeroFunc" value="#{configuracaoGeralController.funcionarioModel.numero}"
                                             required="true" requiredMessage="Número é obrigatório"/>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Bairro *"/>
                                <p:inputText id="bairroFunc" value="#{configuracaoGeralController.funcionarioModel.bairro}"
                                             required="true" requiredMessage="Bairro é obrigatório"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="input-combined">
                                <p:outputLabel styleClass="title-input" value="Complemento"/>
                                <p:inputText id="complementoFunc" value="#{configuracaoGeralController.funcionarioModel.complemento}"/>
                            </div>
                        </div>
                    </div>
				</c:if>

				<!-- Seção: Alterar Senha (Comum a ambos) -->
				<div class="section-divider">
					<i class="fa-solid fa-lock"></i>
					<h3>Segurança</h3>
				</div>
				
				<div class="row">
					<div class="col-md-12">
						<div class="checkbox-container">
							<p:selectBooleanCheckbox id="alterarSenha" 
													 value="#{configuracaoGeralController.alterarSenha}"
													 onchange="toggleSenha();" />
							<p:outputLabel for="alterarSenha" value="Desejo alterar minha senha" />
						</div>
					</div>
				</div>
				
				<div id="senhaFieldsContainer" style="display: none;">
					<div class="row">
						<div class="col-md-4">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Senha atual *" />
								<p:password id="senhaAtual" value="#{configuracaoGeralController.senhaAtual}" 
										   feedback="false" required="#{configuracaoGeralController.alterarSenha}"
										   requiredMessage="Senha atual é obrigatória" />
							</div>
						</div>
						
						<div class="col-md-4">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Nova senha *" />
								<p:password id="novaSenha" value="#{configuracaoGeralController.novaSenha}" 
										   feedback="true" required="#{configuracaoGeralController.alterarSenha}"
										   requiredMessage="Nova senha é obrigatória" 
										   weakLabel="Fraca" goodLabel="Média" strongLabel="Forte" />
							</div>
						</div>
						
						<div class="col-md-4">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Confirmar nova senha *" />
								<p:password id="confirmaNovaSenha" value="#{configuracaoGeralController.confirmaNovaSenha}" 
										   feedback="false" required="#{configuracaoGeralController.alterarSenha}"
										   requiredMessage="Confirmação de senha é obrigatória" />
							</div>
						</div>
					</div>
				</div>
				
				<!-- Botões de ação -->
				<div class="action-buttons">
					<p:commandButton value="Salvar Alterações" 
									 styleClass="btn btn-green medium"
									 action="#{configuracaoGeralController.salvar}"
									 ajax="false" />
				</div>
			</div>
		</h:form>
	</ui:define>

</ui:composition>
</html>
