<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<!-- Usando o template SEM sidebar (full width) -->
<ui:composition template="/WEB-INF/template.xhtml">

	<!-- Título da página -->
	<ui:define name="title">Configurações - BarberSys</ui:define>
	
	<!-- CSS específico desta página -->
	<ui:define name="extra-css">
		<style>
			:root { --avatar-color: #23A4D5; }

			.config-container {
				background: #FFFFFF;
				border-radius: 12px;
				padding: 40px;
				box-shadow: 0 3px 6px #00000029;
				max-width: 1200px;
				margin: 0 auto;
				animation: fadeInUp 0.5s ease-out;
			}

			.avatar-section {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 15px;
				margin-bottom: 35px;
				padding-bottom: 30px;
				border-bottom: 1px solid #EBEBEB;
			}

			.avatar-circle-large {
				width: 120px;
				height: 120px;
				border-radius: 50%;
				background: var(--avatar-color, #23A4D5);
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.avatar-circle-large i {
				font-size: 50px;
				color: white;
			}

			.avatar-info {
				text-align: center;
			}

			.avatar-name {
				font-size: 24px;
				font-weight: 700;
				color: #1F2937;
				margin-bottom: 5px;
				text-transform: uppercase;
			}

			.avatar-role {
				font-size: 14px;
				color: #6B7280;
				font-weight: 600;
				background-color: #f0f0f0;
				padding: 4px 12px;
				border-radius: 12px;
			}

			.section-divider {
				display: flex;
				align-items: center;
				gap: 12px;
				margin: 35px 0 25px 0;
				padding-bottom: 12px;
				border-bottom: 1px solid #EBEBEB;
			}

			.section-divider i {
				font-size: 22px;
				color: #23A4D5;
			}

			.section-divider h3 {
				margin: 0;
				font-size: 18px;
				font-weight: 700;
				color: #374151;
			}

			.checkbox-container {
				display: flex;
				align-items: center;
				gap: 10px;
				margin-bottom: 20px;
			}

			.checkbox-container label {
				font-weight: 600;
				color: #374151;
				cursor: pointer;
				user-select: none;
			}

			.action-buttons {
				display: flex;
				justify-content: center;
				gap: 15px;
				margin-top: 40px;
				padding-top: 25px;
				border-top: 1px solid #EBEBEB;
			}

			@keyframes fadeInUp {
				from { opacity: 0; transform: translateY(20px); }
				to { opacity: 1; transform: translateY(0); }
			}
			
			body .ui-chkbox .ui-chkbox-box .ui-chkbox-icon {
				overflow: visible;
				position: absolute;
				left: 50%;
				top: 50%;
				margin-left: -0.5rem;
				margin-top: -0.5rem;
				transform: translate(-2%, -17%);
			}
		</style>
		
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<script type="text/javascript">
			function definirCorAvatar() {
				var sexo = '#{configuracaoController.clienteModel.sexo}';
				var cor = '#6366F1';
				
				if (sexo === 'M') {
					cor = '#3B82F6';
				} else if (sexo === 'F') {
					cor = '#EC4899';
				} else if (sexo === 'O') {
					cor = '#8B5CF6';
				}
				
				document.documentElement.style.setProperty('--avatar-color', cor);
			}
			
			function toggleSenha() {
				var container = document.getElementById('senhaFieldsContainer');
				if (container.style.display === 'none' || container.style.display === '') {
					container.style.display = 'block';
				} else {
					container.style.display = 'none';
				}
			}
			
			window.onload = function() {
				definirCorAvatar();
			};
		</script>
	</ui:define>

	<!-- Conteúdo da página -->
	<ui:define name="content">
		<p:messages id="messages" showDetail="true" closable="true" />
			
			<div class="config-container">
				<!-- Avatar e informações do usuário -->
				<div class="avatar-section">
					<div class="avatar-circle-large">
						<i class="fa-solid fa-user"></i>
					</div>
					<div class="avatar-info">
						<h:panelGroup id="nomeUsuarioDisplay">
							<div class="avatar-name">#{configuracaoController.nomeUsuario}</div>
						</h:panelGroup>
						<div class="avatar-role">#{configuracaoController.tipoPerfil}</div>
					</div>
				</div>
				
				<!-- Seção: Dados Gerais -->
				<div class="section-divider">
					<i class="fa-solid fa-user-gear"></i>
					<h3>Dados Gerais</h3>
				</div>
				
				<!-- Campos para CLIENTE -->
				<div class="row">
					<div class="col-md-6">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Nome de Usuário *"/>
							<p:inputText id="nomeUsuarioCliente" value="#{configuracaoController.nomeUsuario}"
										 maxlength="100" />
						</div>
					</div>
					<div class="col-md-6">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Nome Completo *"/>
							<p:inputText id="nomeCliente" value="#{configuracaoController.clienteModel.nome}"
										 maxlength="100" />
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Email (Login) *"/>
							<p:inputText id="emailCliente" value="#{configuracaoController.clienteModel.email}"
										 maxlength="100" />
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-4">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="CPF *"/>
							<p:inputMask id="cpfCliente" value="#{configuracaoController.clienteModel.cpf}"
										 mask="999.999.999-99"
										 disabled="true" />
						</div>
					</div>
					<div class="col-md-4">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Telefone *"/>
							<p:inputMask id="telefoneCliente" value="#{configuracaoController.clienteModel.telefone}"
										 mask="(99) 99999-9999" />
						</div>
					</div>
					<div class="col-md-4">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Gênero *" />
							<p:selectOneMenu id="sexoCliente" value="#{configuracaoController.clienteModel.sexo}">
								<f:selectItem itemLabel="Selecionar gênero" itemValue=""/>
								<f:selectItem itemLabel="Masculino" itemValue="M"/>
								<f:selectItem itemLabel="Feminino" itemValue="F"/>
								<f:selectItem itemLabel="Não definido" itemValue="O"/>
							</p:selectOneMenu>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						 <div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Data de Nascimento *"/>
							<p:datePicker id="dataNascCliente" value="#{configuracaoController.clienteModel.dataNascimento}"
										pattern="dd/MM/yyyy"
										disabled="true"
										showIcon="true"/>
						</div>
					</div>
				</div>
				
				<!-- ENDERECO DO CLIENTE (OPCIONAL) -->
				<div class="section-divider">
					<i class="fa-solid fa-map-marker-alt"></i>
					<h3>Endereço (Opcional)</h3>
				</div>
				<div class="row">
					<div class="col-md-3">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="CEP"/>
							<p:inputMask id="cepCliente" value="#{configuracaoController.clienteModel.cep}"
										 mask="99999-999" />
						</div>
					</div>
					<div class="col-md-6">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Cidade"/>
							<p:inputText id="cidadeCliente" value="#{configuracaoController.clienteModel.cidade}" />
						</div>
					</div>
					<div class="col-md-3">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="UF"/>
							<p:inputText id="ufCliente" value="#{configuracaoController.clienteModel.estado}"
										 maxlength="2" />
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-8">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Rua"/>
							<p:inputText id="ruaCliente" value="#{configuracaoController.clienteModel.rua}" />
						</div>
					</div>
					<div class="col-md-2">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Número"/>
							<p:inputText id="numeroCliente" value="#{configuracaoController.clienteModel.numero}" />
						</div>
					</div>
					<div class="col-md-2">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Bairro"/>
							<p:inputText id="bairroCliente" value="#{configuracaoController.clienteModel.bairro}" />
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Complemento"/>
							<p:inputText id="complementoCliente" value="#{configuracaoController.clienteModel.complemento}"/>
						</div>
					</div>
				</div>

				<!-- Seção: Alterar Senha -->
				<div class="section-divider">
					<i class="fa-solid fa-lock"></i>
					<h3>Segurança</h3>
				</div>
				
				<div class="row">
					<div class="col-md-12">
						<div class="checkbox-container">
							<p:selectBooleanCheckbox id="alterarSenhaCliente" 
													 value="#{configuracaoController.alterarSenha}">
								<p:ajax listener="#{configuracaoController.onAlterarSenhaChange}" 
										update="senhaAtualCliente novaSenhaCliente confirmaNovaSenhaCliente"
										oncomplete="toggleSenha();" />
							</p:selectBooleanCheckbox>
							<p:outputLabel for="alterarSenhaCliente" value="Desejo alterar minha senha" />
						</div>
					</div>
				</div>
				
				<div id="senhaFieldsContainer" style="display: none;">
					<div class="row">
						<div class="col-md-4">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Senha atual *" />
								<p:password id="senhaAtualCliente" value="#{configuracaoController.senhaAtual}" 
										   feedback="false" />
							</div>
						</div>
						
						<div class="col-md-4">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Nova senha *" />
								<p:password id="novaSenhaCliente" value="#{configuracaoController.novaSenha}" 
										   feedback="true"
										   weakLabel="Fraca" goodLabel="Média" strongLabel="Forte"
										   promptLabel="Insira a senha" />
							</div>
						</div>
						
						<div class="col-md-4">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Confirmar nova senha *" />
								<p:password id="confirmaNovaSenhaCliente" value="#{configuracaoController.confirmaNovaSenha}" 
										   feedback="false" />
							</div>
						</div>
					</div>
				</div>
				
				<!-- Botões de ação -->
				<div class="action-buttons">
					<p:commandButton value="Salvar Alterações" 
									 styleClass="btn btn-green medium"
									 action="#{configuracaoController.salvarConfiguracoes}"
									 process="@this nomeUsuarioCliente nomeCliente emailCliente telefoneCliente sexoCliente cepCliente cidadeCliente ufCliente ruaCliente numeroCliente bairroCliente complementoCliente alterarSenhaCliente senhaAtualCliente novaSenhaCliente confirmaNovaSenhaCliente"
									 update="messages nomeUsuarioDisplay :form:nomeUsuarioHeader" />
				</div>
			</div>
			
<!-- Modal de Validação de Código -->
		<p:dialog id="dlgValidarCodigoCliente" widgetVar="dlgValidarCodigoCliente" modal="true" 
			showEffect="fade" hideEffect="fade" closable="false" draggable="false" resizable="false"
			styleClass="dialog-validar-email">
			<h:panelGroup id="dlgValidarCodigoClienteForm">
				
				<div class="header-modal">
					<div class="flex align-center">
						<div class="icon-circle">
							<i class="fa-solid fa-envelope-circle-check"></i>
						</div>
						<label>Validar Email</label>
					</div>
					<div class="flex align-center">
						<p:commandButton styleClass="btn-x" icon="fa-solid fa-xmark"
							onclick="PF('dlgValidarCodigoCliente').hide()"/>
					</div>
				</div>

				<div style="padding: 20px 20px 0 20px; text-align: center;">
					<p style="margin-bottom: 25px; color: #666; font-size: 14px;">
						Digite o código de 6 dígitos enviado para<br/>
						<strong>#{configuracaoController.clienteModel.email}</strong>
					</p>

					<div class="input-combined" style="margin: 0 auto 25px auto; max-width: 280px;">
						<p:outputLabel styleClass="title-input" value="Código de Verificação *" />
						<p:inputText id="codigoValidacaoCliente" 
							value="#{configuracaoController.codigoDigitado}"
							maxlength="6"/>
					</div>
				</div>

				<div class="flex align-center justify-center" style="padding: 0 20px 20px 20px;">
					<p:commandButton value="Validar" 
						styleClass="btn medium btn-green"
						action="#{configuracaoController.validarCodigo()}"
						update="dlgValidarCodigoClienteForm messages"
						process="dlgValidarCodigoClienteForm"
						ajax="true"/>
						
					<p:commandButton value="Reenviar Código" 
						styleClass="btn medium btn-cancel"
						action="#{configuracaoController.reenviarCodigo()}"
						update="dlgValidarCodigoClienteForm messages"
						process="@this"/>
				</div>
			</h:panelGroup>
		</p:dialog>
	</ui:define>

</ui:composition>
</html>
