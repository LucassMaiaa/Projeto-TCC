<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<!-- Usando o template com sidebar -->
<ui:composition template="/WEB-INF/template-with-sidebar.xhtml">

	<!-- Título da página -->
	<ui:define name="title">Dashboard - BarberSys</ui:define>
	
	<!-- CSS específico desta página -->
	<ui:define name="extra-css">
		<style>
/* Container do gráfico de visitas - Seguindo padrão do sistema */
.content-top-visitas {
	border: 1px solid #DDE3DF;
	border-radius: 8px;
	height: 281px;
	padding: 14px 25px;
	display: flex;
	flex-direction: column;
}

/* Wrapper do gráfico - estilo padrão do sistema */
.grafico-visitas-wrapper {
	background: rgba(255, 255, 255, 0.3);
	border-radius: 8px;
	padding: 15px 10px 8px;
	position: relative;
	flex: 1;
	display: flex;
	flex-direction: column;
}

/* Container das colunas */
.grafico-visitas-container {
	display: flex;
	align-items: flex-end;
	justify-content: space-between;
	height: 145px;
	position: relative;
	gap: 8px;
	padding: 0 4px;
}

/* Coluna individual do dia */
.dia-visita-coluna {
	display: flex;
	flex-direction: column-reverse;
	align-items: center;
	flex: 1;
	position: relative;
	height: 100%;
	animation: slideUpVisitas 0.6s ease-out backwards;
}

/* Animação de entrada escalonada - mantendo a animação bonita */
.dia-visita-coluna:nth-child(1) { animation-delay: 0.05s; }
.dia-visita-coluna:nth-child(2) { animation-delay: 0.1s; }
.dia-visita-coluna:nth-child(3) { animation-delay: 0.15s; }
.dia-visita-coluna:nth-child(4) { animation-delay: 0.2s; }
.dia-visita-coluna:nth-child(5) { animation-delay: 0.25s; }
.dia-visita-coluna:nth-child(6) { animation-delay: 0.3s; }
.dia-visita-coluna:nth-child(7) { animation-delay: 0.35s; }

@keyframes slideUpVisitas {
	0% {
		opacity: 0;
		transform: translateY(30px) scale(0.8);
	}
	60% {
		opacity: 1;
		transform: translateY(-5px) scale(1.05);
	}
	100% {
		opacity: 1;
		transform: translateY(0) scale(1);
	}
}

/* Barra vertical - estilo clean do sistema */
.dia-barra-vertical {
	width: 100%;
	max-width: 30px;
	background: linear-gradient(180deg, #EF9A9A 0%, #E57373 100%);
	border-radius: 4px 4px 0 0;
	position: relative;
	transition: all 0.3s ease;
	box-shadow: 0 2px 6px rgba(239, 83, 80, 0.25);
	cursor: pointer;
	max-height: 130px;
	bottom: 20px;
}

/* Efeito hover suave */
.dia-barra-vertical:hover {
	background: linear-gradient(180deg, #F48FB1 0%, #EC407A 100%);
	box-shadow: 0 3px 10px rgba(239, 83, 80, 0.4);
	transform: translateY(-2px);
}

/* Número de visitas no topo da barra */
.dia-count-visitas {
	position: absolute;
	top: -20px;
	left: 50%;
	transform: translateX(-50%);
	font-size: 12px;
	font-weight: 700;
	color: #4A5A6A;
	white-space: nowrap;
}

/* Label do dia da semana */
.dia-label-visitas {
	position: absolute;
	left: 50%;
	transform: translateX(-50%);
	font-size: 10px;
	font-weight: 600;
	color: #6A7A8A;
	text-transform: uppercase;
	letter-spacing: 0.3px;
	white-space: nowrap;
}

.content-gastos-mes {
	background: linear-gradient(135deg, #C5D9BF 0%, #D4E5CE 100%);
	height: 281px;
	border-radius: 12px;
	padding: 20px 25px;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
	transition: transform 0.3s ease, box-shadow 0.3s ease;
	display: flex;
	flex-direction: column;
}

.content-gastos-mes:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
}

.content-gastos-mes .sub-info {
	font-size: 42px !important;
	font-weight: 800 !important;
	color: #2C4A2C !important;
	display: block !important;
	letter-spacing: -1px;
	margin-top: 12px;
}

.icon-circle-green {
	background: linear-gradient(135deg, #4EB458 0%, #3EA048 100%) !important;
	box-shadow: 0 4px 12px rgba(78, 180, 88, 0.3);
	animation: pulse-icon-green 2.5s ease-in-out infinite;
	position: relative;
}

.icon-circle-green::after {
	content: '';
	position: absolute;
	top: -2px;
	left: -2px;
	right: -2px;
	bottom: -2px;
	background: linear-gradient(135deg, #4EB458, #66BB6A);
	border-radius: 50%;
	opacity: 0;
	z-index: -1;
	animation: pulse-ring-green 2.5s ease-in-out infinite;
}

/* Ícone vermelho com animação premium */
.icon-circle-red {
	background: linear-gradient(135deg, #EF5350 0%, #E53935 100%) !important;
	box-shadow: 0 4px 12px rgba(239, 83, 80, 0.35);
	animation: pulse-icon-red 2.5s ease-in-out infinite;
	position: relative;
}

.icon-circle-red::after {
	content: '';
	position: absolute;
	top: -2px;
	left: -2px;
	right: -2px;
	bottom: -2px;
	background: linear-gradient(135deg, #EF5350, #EC407A);
	border-radius: 50%;
	opacity: 0;
	z-index: -1;
	animation: pulse-ring 2.5s ease-in-out infinite;
}

@keyframes pulse-ring {
	0%, 100% {
		transform: scale(1);
		opacity: 0;
	}
	50% {
		transform: scale(1.15);
		opacity: 0.3;
	}
}

@keyframes pulse-icon-red {
	0%, 100% {
		transform: scale(1);
		box-shadow: 0 4px 12px rgba(239, 83, 80, 0.35);
	}
	50% {
		transform: scale(1.08);
		box-shadow: 0 6px 18px rgba(239, 83, 80, 0.5);
	}
}

@keyframes pulse-icon-green {
	0%, 100% {
		transform: scale(1);
		box-shadow: 0 4px 12px rgba(78, 180, 88, 0.3);
	}
	50% {
		transform: scale(1.08);
		box-shadow: 0 6px 18px rgba(78, 180, 88, 0.5);
	}
}

@keyframes pulse-ring-green {
	0%, 100% {
		transform: scale(1);
		opacity: 0;
	}
	50% {
		transform: scale(1.15);
		opacity: 0.3;
	}
}

@keyframes pulse-icon-blue {
	0%, 100% {
		transform: scale(1);
		box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
	}
	50% {
		transform: scale(1.08);
		box-shadow: 0 6px 18px rgba(74, 144, 226, 0.5);
	}
}

@keyframes pulse-ring-blue {
	0%, 100% {
		transform: scale(1);
		opacity: 0;
	}
	50% {
		transform: scale(1.15);
		opacity: 0.3;
	}
}

.content-faturado {
	border-radius: 12px;
	background: linear-gradient(135deg, #D8E0E8 0%, #E8EEF5 100%);
	padding: 20px 25px;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
	transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.content-faturado:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
}

.icon-circle-blue {
	background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%) !important;
	box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
	animation: pulse-icon-blue 2.5s ease-in-out infinite;
	position: relative;
}

.icon-circle-blue::after {
	content: '';
	position: absolute;
	top: -2px;
	left: -2px;
	right: -2px;
	bottom: -2px;
	background: linear-gradient(135deg, #4A90E2, #64B5F6);
	border-radius: 50%;
	opacity: 0;
	z-index: -1;
	animation: pulse-ring-blue 2.5s ease-in-out infinite;
}

@keyframes pulse-icon {
	0%, 100% {
		transform: scale(1);
		box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
	}
	50% {
		transform: scale(1.05);
		box-shadow: 0 6px 16px rgba(74, 144, 226, 0.5);
	}
}



/* Área do gráfico com fundo sutil */
.content-grafic {
	background: rgba(255, 255, 255, 0.1);
	border-radius: 8px;
	padding: 15px 8px 8px;
	position: relative;
}

/* Animação de entrada das barras */
.barra-wrapper {
	animation: slideUp 0.6s ease-out backwards;
	position: relative !important;
}

/* SETINHA DO MÊS ATUAL - PARA BAIXO */
.barra-wrapper.active::before {
	content: "" !important;
	display: block !important;
	width: 0 !important;
	height: 0 !important;
	border-left: 8px solid transparent !important;
	border-right: 8px solid transparent !important;
	border-top: 12px solid #869A26 !important;
	position: absolute !important;
	top: -20px !important;
	left: 50% !important;
	transform: translateX(-50%) !important;
	animation: bounce 1.5s ease-in-out infinite !important;
	z-index: 10 !important;
}

/* COLUNA VERDE DO MÊS ATUAL - SEM NEON */
.barra-wrapper.active .fluxo-grafico {
	background: linear-gradient(180deg, #A6CF3A 0%, #8FB832 100%) !important;
	border: 1px solid #7A9B2A !important;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
	max-width: 42px !important;
}

.barra-wrapper.active:hover .fluxo-grafico {
	background: linear-gradient(180deg, #B5DC45 0%, #9DC738 100%) !important;
	box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2) !important;
}

/* LABEL DO MÊS ATUAL */
.barra-wrapper.active .label-mes {
	color: #869A26 !important;
	font-size: 14px !important;
	font-weight: 800 !important;
}

.barra-wrapper:nth-child(1) { animation-delay: 0.05s; }
.barra-wrapper:nth-child(2) { animation-delay: 0.1s; }
.barra-wrapper:nth-child(3) { animation-delay: 0.15s; }
.barra-wrapper:nth-child(4) { animation-delay: 0.2s; }
.barra-wrapper:nth-child(5) { animation-delay: 0.25s; }
.barra-wrapper:nth-child(6) { animation-delay: 0.3s; }
.barra-wrapper:nth-child(7) { animation-delay: 0.35s; }
.barra-wrapper:nth-child(8) { animation-delay: 0.4s; }
.barra-wrapper:nth-child(9) { animation-delay: 0.45s; }
.barra-wrapper:nth-child(10) { animation-delay: 0.5s; }
.barra-wrapper:nth-child(11) { animation-delay: 0.55s; }
.barra-wrapper:nth-child(12) { animation-delay: 0.6s; }

@keyframes slideUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* Tooltip com design premium do sistema */
#chartTooltip {
	position: fixed !important;
	z-index: 999999 !important;
	pointer-events: none !important;
	padding: 0 !important;
	transition: opacity 0.2s ease, visibility 0.2s ease !important;
	filter: drop-shadow(0 6px 20px rgba(0, 0, 0, 0.15));
}

#chartTooltip::before {
	content: '';
	position: absolute;
	left: -8px;
	top: 50%;
	transform: translateY(-50%);
	width: 0;
	height: 0;
	border-top: 8px solid transparent;
	border-bottom: 8px solid transparent;
	border-right: 8px solid #FFFFFF;
	filter: drop-shadow(-2px 0 3px rgba(0, 0, 0, 0.1));
}

.tooltip-inner {
	background: linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%);
	border: 2px solid #E8EEF5;
	border-radius: 10px;
	padding: 10px 16px;
	min-width: 100px;
	text-align: center;
	position: relative;
	overflow: hidden;
}

.tooltip-inner::before {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 3px;
	background: linear-gradient(90deg, #4A90E2, #64B5F6, #4A90E2);
	background-size: 200% 100%;
	animation: shimmerTooltip 2s linear infinite;
}

@keyframes shimmerTooltip {
	0% { background-position: -200% 0; }
	100% { background-position: 200% 0; }
}

#tooltipText {
	display: block;
	font-size: 11px !important;
	font-weight: 600 !important;
	color: #6A7A8A !important;
	text-transform: uppercase;
	letter-spacing: 0.5px;
	margin-bottom: 4px;
}

.tooltip-value {
	display: block;
	font-size: 16px !important;
	font-weight: 800 !important;
	color: #2C3E50 !important;
	letter-spacing: -0.5px;
	background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
	-webkit-background-clip: text;
	-webkit-text-fill-color: transparent;
	background-clip: text;
}

.content-top-func {
	border: 1px solid #DDE3DF;
	border-radius: 8px;
	padding: 14px 25px;
}

.content-logo-system {
	height: 132px;
	width: 100%;
	background: #F5F5F7;
	background-image: url('resources/images/logo-com-imagem.svg');
	background-repeat: no-repeat;
	background-position: center top;
}

.content-btns {
	width: 100%;
	height: 54px;
	display: flex;
	justify-content: center;
	padding: 8px;
}

.content-resumo {
	width: calc(100% - 24px);
	margin: 12px;
	display: flex;
	flex-direction: column;
	gap: 6px;
}

.resumo-card {
	background: linear-gradient(135deg, #C5D9BF 0%, #D4E5CE 100%);
	border-radius: 8px;
	padding: 10px 12px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.resumo-card.card-faturamento {
	background: linear-gradient(135deg, #D8E0E8 0%, #E8EEF5 100%);
}

.resumo-card-header {
	display: flex;
	align-items: center;
	gap: 6px;
	margin-bottom: 6px;
}

.resumo-icon {
	width: 22px;
	height: 22px;
	background: rgba(255, 255, 255, 0.5);
	border-radius: 6px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 11px;
	color: #4A5A4A;
}

.card-faturamento .resumo-icon {
	color: #4A5A6A;
}

.resumo-label {
    font-size: 12px;
    font-weight: 600;
    color: #5A6A5A;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    margin-left: 3px;
}

.card-faturamento .resumo-label {
	color: #5A6A7A;
}

.resumo-valor {
	font-size: 18px;
	font-weight: 700;
	color: #2C4A2C;
	line-height: 1;
}

.card-faturamento .resumo-valor {
	color: #2C3E50;
}

.resumo-proximo {
	background: linear-gradient(135deg, #E8F0E8 0%, #F0F8F0 100%);
	border-radius: 8px;
	padding: 10px 12px;
	border-left: 3px solid #66BB6A;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.resumo-proximo-label {
    font-size: 12px;
    font-weight: 700;
    color: #5A7A5A;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
    display: block;
}
.resumo-proximo-info {
	font-size: 14px;
	font-weight: 600;
	color: #2C4A2C;
	display: flex;
	align-items: center;
	gap: 6px;
}

.resumo-proximo-info i {
	color: #66BB6A;
	    font-size: 17px;
}

.resumo-vazio {
    font-size: 14px;
    color: #7A8A7A;
    display: block;
    font-weight: 500;
}

.content-servicos {
	height: calc(100vh - 341px);
	background: #FCFCFF;
	border-radius: 8px 8px 0 0;
	padding: 20px;
}

/* Cards de serviços mais solicitados */
.servico-card {
	background: #FFFFFF;
	border: 1px solid #E8EEF3;
	border-radius: 8px;
	padding: 14px 16px;
	margin-bottom: 12px;
	transition: all 0.3s ease;
	position: relative;
	overflow: hidden;
}

.servico-card::before {
	content: '';
	position: absolute;
	left: 0;
	top: 0;
	bottom: 0;
	width: 4px;
	background: linear-gradient(180deg, #66BB6A 0%, #4CAF50 100%);
	opacity: 0;
	transition: opacity 0.3s ease;
}

.servico-card:hover::before {
	opacity: 1;
}

.servico-card:hover {
	box-shadow: 0 4px 12px rgba(102, 187, 106, 0.15);
	transform: translateY(-2px);
	border-color: #C8E6C9;
}

.servico-header {
	display: flex;
	justify-content: space-between;
	align-items: flex-start;
	margin-bottom: 10px;
}

.servico-info {
	flex: 1;
}

.servico-nome {
	font-size: 13px;
	font-weight: 600;
	color: #2C3E50;
	margin-bottom: 4px;
	display: block;
}

.servico-preco {
	font-size: 14px;
	font-weight: 600;
	color: #66BB6A;
	display: flex;
	align-items: center;
	gap: 4px;
}

.servico-preco i {
	font-size: 10px;
}

.servico-quantidade {
	display: flex;
	flex-direction: column;
	align-items: flex-end;
}

.servico-total {
	font-size: 20px;
	font-weight: 700;
	color: #2C4A2C;
	line-height: 1;
	margin-bottom: 2px;
}

.servico-label {
	font-size: 12px;
	font-weight: 600;
	color: #7A8A9A;
	text-transform: uppercase;
	letter-spacing: 0.5px;
}

.servico-barra-container {
	margin-top: 10px;
	height: 6px;
	background: #F0F4F8;
	border-radius: 3px;
	overflow: hidden;
	position: relative;
}

.servico-barra-fill {
	height: 100%;
	background: linear-gradient(90deg, #66BB6A 0%, #81C784 100%);
	border-radius: 3px;
	transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
	position: relative;
}

.servico-porcentagem {
	position: absolute;
	right: 8px;
	top: -18px;
	font-size: 10px;
	font-weight: 700;
	color: #66BB6A;
}

.servicos-vazio {
	text-align: center;
	padding: 40px 20px;
	color: #999;
}

.servicos-vazio i {
	font-size: 40px;
	margin-bottom: 12px;
	color: #DDD;
	display: block;
}

.servicos-vazio p {
	font-size: 12px;
	color: #999;
	margin: 0;
}

/* Estilos do gráfico de agendamentos */
.progress-item {
	margin-bottom: 18px;
	display: flex;
	align-items: center;
	gap: 12px;
}

.progress-label-left {
	display: flex;
	align-items: center;
	gap: 8px;
	min-width: 110px;
}

.progress-dot {
	width: 8px;
	height: 8px;
	border-radius: 50%;
	display: inline-block;
	flex-shrink: 0;
}

.progress-dot.finalizados {
	background-color: #6B8E5A;
}

.progress-dot.cancelados {
	background-color: #C4D86F;
}

.progress-label-text {
    font-size: 12px;
    font-weight: 600;
    color: black;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
}

.progress-bar-container {
	flex: 1;
	height: 26px;
	background-color: #E8F0E3;
	border-radius: 9px;
	overflow: hidden;
	position: relative;
}

.progress-bar-fill {
	height: 100%;
	border-radius: 12px;
	transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
	position: relative;
	display: flex;
	align-items: center;
	justify-content: flex-end;
	padding-right: 8px;
}

.progress-bar-fill.finalizados {
	background: linear-gradient(90deg, #6B8E5A 0%, #97AC95 100%);
}

.progress-bar-fill.cancelados {
	background: linear-gradient(90deg, #C4D86F 0%, #D4E87F 100%);
}

.progress-percentage {
    font-size: 12px;
    font-weight: 700;
    color: black;
    white-space: nowrap;
}

.total-agendamentos-section {
	margin-top: 24px;
	padding-top: 18px;
	border-top: 1px solid #D8E3D3;
}

.total-agendamentos-label {
	font-size: 11px;
	font-weight: 600;
	color: #7A8A7A;
	text-transform: uppercase;
	letter-spacing: 0.5px;
	margin-bottom: 4px;
	display: block;
}

.total-agendamentos-number {
	font-size: 30px;
	font-weight: 800;
	color: #2C4A2C;
	line-height: 1;
	display: block;
	letter-spacing: -2px;
}

.cardsServicos{
    overflow-y: auto;
        max-height: 52vh;
    display: inline-block;
    width: 100%;
}
		</style>
	</ui:define>

	<!-- Conteúdo CENTRAL da página -->
	<ui:define name="content">
	
		<!-- Título e Filtros -->
		<div class="flex space-between">
					<p:outputLabel class="title-page" value="Dashboard Geral" />
				</div>

				<div class="header-filters">
					<div class="row">
						<div class="col-md-4">

							<div class="content-filter ">
								<i class="fa-solid fa-filter"></i>
								<p:selectOneButton value="#{homeController.dataSelecionada}"
									unselectable="false">
									<f:selectItem itemLabel="mês" itemValue="m" />
									<f:selectItem itemLabel="ano" itemValue="a" />
									<p:ajax update="lblFaturado graficoFaturamento graficoAgendamentos lblAgendamentos topFuncionario graficoVisitas" 
									        listener="#{homeController.onFiltroChange()}" 
									        process="@this" 
									        oncomplete="animarBarrasComTransition(); animarBarrasVisitas();" />
								</p:selectOneButton>
							</div>

						</div>
					</div>
				</div>

				<!-- Tooltip flutuante FORA de tudo -->
				<div id="chartTooltip" style="visibility: hidden; opacity: 0;">
					<div class="tooltip-inner">
						<span id="tooltipText"></span>
						<span class="tooltip-value" id="tooltipValue">R$ 0,00</span>
					</div>
				</div>

				<div class="grid-top-grafico">
					<div class="content-faturado">
						<div class="flex">
							<div class="icon-circle icon-circle-blue">
								<i class="fa-solid fa-hand-holding-dollar"></i>
							</div>
							<div class="subtitle-info">
								<h:panelGroup id="lblFaturado">
									<h:outputLabel class="title-info" 
									               value="Faturado no - #{homeController.dataSelecionada == 'm' ? 'mês' : 'ano'}" />
									<h:outputLabel class="sub-info" 
									               value="#{homeController.totalFaturadoFormatado}" />
								</h:panelGroup>

							</div>
						</div>

						<h:panelGroup id="graficoFaturamento">
							<div class="content-grafic">
								<ui:repeat var="mes" value="#{[1,2,3,4,5,6,7,8,9,10,11,12]}">
									<div class="barra-wrapper #{homeController.isMesAtual(mes) ? 'active' : ''} #{homeController.temDados(mes) ? 'com-dados' : 'sem-dados'}"
									     data-valor="#{homeController.getValorMes(mes)}"
									     data-mes="#{homeController.getLabelMes(mes)}"
									     onmouseenter="showTooltip(event, this)" 
									     onmousemove="moveTooltip(event)" 
									     onmouseleave="hideTooltip()">
										<div class="fluxo-grafico" 
										     style="height: #{homeController.getAlturaBarra(mes)}%;">
										</div>
										<label class="label-mes">#{homeController.getLabelMes(mes)}</label>
									</div>
								</ui:repeat>
							</div>
						</h:panelGroup>
						
						<script>
						//<![CDATA[
						// Variáveis globais para o tooltip
						var chartTooltip = null;
						var tooltipTextElement = null;
						var tooltipValueElement = null;
						var isTooltipVisible = false;
						
						// Inicializa quando o DOM estiver pronto
						window.addEventListener('load', function() {
						    chartTooltip = document.getElementById('chartTooltip');
						    tooltipTextElement = document.getElementById('tooltipText');
						    tooltipValueElement = document.getElementById('tooltipValue');
						});
						
						function showTooltip(event, element) {
						    // Garante que os elementos existem
						    if (!chartTooltip) chartTooltip = document.getElementById('chartTooltip');
						    if (!tooltipTextElement) tooltipTextElement = document.getElementById('tooltipText');
						    if (!tooltipValueElement) tooltipValueElement = document.getElementById('tooltipValue');
						    
						    if (!chartTooltip || !tooltipTextElement || !tooltipValueElement) return;
						    
						    // Pega os valores dos atributos
						    var valor = element.getAttribute('data-valor');
						    var mes = element.getAttribute('data-mes');
						    
						    // Atualiza o texto do mês e valor
						    tooltipTextElement.textContent = mes ? mes.toUpperCase() : '';
						    tooltipValueElement.textContent = valor;
						    
						    // Mostra o tooltip IMEDIATAMENTE
						    chartTooltip.style.visibility = 'visible';
						    chartTooltip.style.opacity = '1';
						    isTooltipVisible = true;
						    
						    // Posiciona imediatamente
						    moveTooltip(event);
						}
						
						function moveTooltip(event) {
						    if (!chartTooltip || !isTooltipVisible) return;
						    
						    // Configurações de offset
						    var offsetX = 20;
						    var offsetY = -15;
						    
						    // Posição base do cursor
						    var x = event.clientX + offsetX;
						    var y = event.clientY + offsetY;
						    
						    // Dimensões do tooltip e janela
						    var tooltipWidth = chartTooltip.offsetWidth;
						    var tooltipHeight = chartTooltip.offsetHeight;
						    var windowWidth = window.innerWidth;
						    var windowHeight = window.innerHeight;
						    
						    // Ajusta se sair pela direita
						    if (x + tooltipWidth > windowWidth - 20) {
						        x = event.clientX - tooltipWidth - offsetX;
						    }
						    
						    // Ajusta se sair por baixo
						    if (y + tooltipHeight > windowHeight - 20) {
						        y = windowHeight - tooltipHeight - 20;
						    }
						    
						    // Ajusta se sair por cima
						    if (y < 20) {
						        y = 20;
						    }
						    
						    // Aplica posição
						    chartTooltip.style.left = x + 'px';
						    chartTooltip.style.top = y + 'px';
						}
						
						function hideTooltip() {
						    if (!chartTooltip) chartTooltip = document.getElementById('chartTooltip');
						    if (!chartTooltip) return;
						    
						    isTooltipVisible = false;
						    
						    // Esconde IMEDIATAMENTE
						    chartTooltip.style.opacity = '0';
						    chartTooltip.style.visibility = 'hidden';
						}
						//]]>
						</script>
					</div>
					<div class="content-top-func">
						<div class="flex">
							<div class="icon-circle">
								<i class="fa-solid fa-medal"></i>
							</div>
							<div class="subtitle-info">
								<label class="title-info">Top Funcionário</label>
							</div>
						</div>

						<h:panelGroup id="topFuncionario">
							<div class="flex align-center column">
								<div class="perfil-top-funcionario"></div>
								<label class="title-name-top-func">#{homeController.topFuncionarioNome}</label>

								<div class="content-obj">
									<div class="flex">
										<div class="icon-circle">
											<i class="fa-solid fa-star"></i>
										</div>
										<div>
											<label class="title-obj">Avaliação</label> 
											<label class="subtitle-obj">#{homeController.topFuncionarioAvaliacaoFormatada}</label>
										</div>
									</div>
									<div class="flex">
										<div class="icon-circle">
											<i class="fa-solid fa-scissors"></i>
										</div>
										<div>
											<label class="title-obj">Total de cortes</label> 
											<label class="subtitle-obj">#{homeController.topFuncionarioAtendimentos}</label>
										</div>
									</div>
								</div>
							</div>
						</h:panelGroup>
					</div>
				</div>
				<div class="grid-bottom-grafico">
					<div class="content-top-visitas">
						<div class="flex" style="margin-bottom: 18px;">
							<div class="icon-circle icon-circle-red">
								<i class="fa-solid fa-people-group"></i>
							</div>
							<div class="subtitle-info">
								<label class="title-info">Top Visitas na semana</label>
							</div>
						</div>
						
						<h:panelGroup id="graficoVisitas">
							<!-- Gráfico de colunas verticais dos dias da semana -->
							<div class="grafico-visitas-wrapper">
								<div class="grafico-visitas-container">
									<ui:repeat var="dia" value="#{[1,2,3,4,5,6,7]}">
										<div class="dia-visita-coluna">
											<div class="dia-barra-vertical" 
											     style="height: #{homeController.getPorcentagemVisitasDia(dia)}%;"
											     title="#{homeController.getVisitasDia(dia)} visitas">
												<span class="dia-count-visitas">#{homeController.getVisitasDia(dia)}</span>
											</div>
											<label class="dia-label-visitas">#{homeController.getNomeDia(dia)}</label>
										</div>
									</ui:repeat>
								</div>
							</div>
						</h:panelGroup>
						
						<script>
						//<![CDATA[
						// Anima as barras de visitas ao carregar
						function animarBarrasVisitas() {
							setTimeout(function() {
								var barras = document.querySelectorAll('#form\\:graficoVisitas .dia-barra-vertical');
								barras.forEach(function(barra, index) {
									setTimeout(function() {
										barra.style.height = barra.style.height;
									}, index * 50);
								});
							}, 100);
						}
						
						// Executa ao carregar a página
						window.addEventListener('load', animarBarrasVisitas);
						//]]>
						</script>
					</div>
					<div class="content-gastos-mes">
						<div class="flex" style="margin-bottom: 20px;">
							<div class="icon-circle icon-circle-green">
								<i class="fa-solid fa-calendar-plus"></i>
							</div>

							<div class="subtitle-info">
								<h:panelGroup id="lblAgendamentos">
									<h:outputLabel class="title-info" 
									               value="Agendamentos - #{homeController.dataSelecionada == 'm' ? 'mês' : 'ano'}" />
								</h:panelGroup>
							</div>
						</div>
						
						<h:panelGroup id="graficoAgendamentos">
							<!-- Barra de Finalizados -->
							<div class="progress-item">
								<div class="progress-label-left">
									<span class="progress-dot finalizados"></span>
									<span class="progress-label-text">Finalizados</span>
								</div>
								<div class="progress-bar-container">
									<div class="progress-bar-fill finalizados" 
									     style="width: #{homeController.porcentagemFinalizados}%;">
										<span class="progress-percentage">#{homeController.porcentagemFinalizados}%</span>
									</div>
								</div>
							</div>
							
							<!-- Barra de Cancelados -->
							<div class="progress-item">
								<div class="progress-label-left">
									<span class="progress-dot cancelados"></span>
									<span class="progress-label-text">Cancelados</span>
								</div>
								<div class="progress-bar-container">
									<div class="progress-bar-fill cancelados" 
									     style="width: #{homeController.porcentagemCancelados}%;">
										<span class="progress-percentage">#{homeController.porcentagemCancelados}%</span>
									</div>
								</div>
							</div>
							
							<!-- Total de Agendamentos -->
							<div class="total-agendamentos-section">
								<span class="total-agendamentos-label">Total de agendamentos</span>
								<span class="total-agendamentos-number">#{homeController.totalAgendamentos}</span>
							</div>
						</h:panelGroup>
						
						<script>
						//<![CDATA[
						function animarBarrasComTransition() {
							// Aguarda o DOM ser atualizado completamente
							setTimeout(function() {
								var barras = document.querySelectorAll('#form\\:graficoAgendamentos .progress-bar-fill');
								
								barras.forEach(function(barra) {
									// Pega o width final do style inline (vem do JSF)
									var widthFinal = barra.style.width;
									
									if (widthFinal) {
										// Remove a transição temporariamente
										barra.style.transition = 'none';
										
										// Define como 0% para começar
										barra.style.width = '0%';
										
										// Força o navegador a aplicar o 0%
										barra.offsetHeight;
										
										// Reativa a transição
										barra.style.transition = 'width 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
										
										// Aplica o width final com animação
										barra.style.width = widthFinal;
									}
								});
							}, 50);
						}
						
						// Executa na primeira carga da página
						document.addEventListener('DOMContentLoaded', function() {
							animarBarrasComTransition();
							animarBarrasVisitas();
						});
						
						// Função para animar as barras de visitas (verticais)
						function animarBarrasVisitas() {
							setTimeout(function() {
								var barras = document.querySelectorAll('#form\\:graficoVisitas .dia-barra-vertical');
								
								barras.forEach(function(barra) {
									var heightFinal = barra.style.height;
									
									if (heightFinal) {
										barra.style.transition = 'none';
										barra.style.height = '10px';
										barra.offsetHeight;
										barra.style.transition = 'height 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
										barra.style.height = heightFinal;
									}
								});
							}, 100);
						}
						//]]>
						</script>

					</div>
				</div>
		
		<!-- Modal de Agendamento -->
		<p:dialog id="dlgAgendar" widgetVar="dlgAgendar" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<div class="header-modal">
				<div class="flex align-center">
					<div class="icon-circle">
						<i class="fa-solid fa-calendar-days"></i>

					</div>
					<label>Agendamento</label>
				</div>
				<div class="flex align-center">
					<p:commandButton
						actionListener="#{funcionarioController.adicionarNovoFuncionario()}"
						styleClass="btn btn-green" value="Agendar" />
					<div>
						<p:commandButton styleClass="btn-x" icon="fa-solid fa-xmark"
							onclick="PF('dlgAgendar').hide()" />
					</div>
				</div>


			</div>

			<div class="row">
				<div class="col-md-6">
					<div class="content-filter no-filter">
						<p:selectOneButton value="#{agendamentoController.tipoCadastro}"
							unselectable="false">
							<f:selectItem itemLabel="Com cadastro" itemValue="c" />
							<f:selectItem itemLabel="Sem cadastros" itemValue="s" />
							<p:ajax update="dlgAttCliente" process="@this" />
						</p:selectOneButton>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-8">
					<p:outputPanel id="dlgAttCliente">
						<ui:fragment
							rendered="#{agendamentoController.tipoCadastro eq 'c'}">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Nome do Cliente" />
								<p:selectOneMenu converter="#{countryConverter}" var="c"
									filter="true" filterMatchMode="startsWith">

									<f:selectItems var="country" />

									<p:column>
										<span class="flag" />
									</p:column>

									<p:column>
										<f:facet name="header">
											<h:outputText value="Name" />
										</f:facet>
										<h:outputText />
									</p:column>

									<f:facet name="footer">
										<h:outputText />
									</f:facet>
								</p:selectOneMenu>
							</div>
						</ui:fragment>
						<ui:fragment
							rendered="#{agendamentoController.tipoCadastro eq 's'}">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Nome do Cliente" />
								<p:inputText styleClass="senha-login" />
							</div>
						</ui:fragment>

					</p:outputPanel>
				</div>
				<div class="col-md-4">
					<div class="input-combined">
						<p:outputLabel styleClass="title-input" value="Selecione uma data" />
						<p:datePicker showIcon="true" pattern="dd/MM/yyyy" autocomplete="off" />
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-8">
					<div class="input-combined">
						<p:outputLabel styleClass="title-input"
							value="Nome do funcionário" />
						<p:selectOneMenu>
							<f:selectItem itemLabel="Selecione funcionário" itemValue="" />
							<f:selectItems />
							<f:facet name="footer">
								<p:divider styleClass="mt-0" />
								<h:outputText value="3 options" style="font-weight:bold;" />
							</f:facet>
						</p:selectOneMenu>
					</div>

				</div>

				<div class="col-md-4">
					<div class="input-combined">
						<p:outputLabel styleClass="title-input"
							value="Horários disponíveis" />
						<p:selectOneMenu>
							<f:selectItem itemLabel="Selecione horário" itemValue="" />
							<f:selectItems />
							<f:facet name="footer">
								<p:divider styleClass="mt-0" />
								<h:outputText value="3 options" style="font-weight:bold;" />
							</f:facet>
						</p:selectOneMenu>
					</div>

				</div>
			</div>
		</p:dialog>
		
	</ui:define>

	<!-- Conteúdo da SIDEBAR DIREITA -->
	<ui:define name="sidebar">
		<div class="content-logo-system"></div>
		
		<!-- Resumo de Hoje -->
		<div>
			<h:panelGroup id="resumoHoje" class="content-resumo">
				<!-- Card Agendamentos -->
				<div class="resumo-card">
					<div class="resumo-card-header">
						<div class="resumo-icon">
							<i class="fa-solid fa-calendar-check"></i>
						</div>
						<span class="resumo-label">Agendamentos de Hoje</span>
					</div>
					<div class="resumo-valor">#{homeController.agendamentosHoje}</div>
				</div>
				
				<!-- Card Faturamento -->
				<div class="resumo-card card-faturamento">
					<div class="resumo-card-header">
						<div class="resumo-icon">
							<i class="fa-solid fa-hand-holding-dollar"></i>
						</div>
						<span class="resumo-label">Faturamento de Hoje</span>
					</div>
					<div class="resumo-valor">#{homeController.faturamentoHojeFormatado}</div>
				</div>
				
				<!-- Card Próximo -->
				<h:panelGroup rendered="#{not empty homeController.proximoAgendamento}">
					<div class="resumo-proximo">
						<span class="resumo-proximo-label">Próximo Agendamento</span>
						<div class="resumo-proximo-info">
							<i class="fa-solid fa-clock"></i>
							#{homeController.proximoAgendamentoFormatado}
						</div>
					</div>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{empty homeController.proximoAgendamento}">
					<div class="resumo-proximo">
						<span class="resumo-vazio">Sem agendamentos pendentes</span>
					</div>
				</h:panelGroup>
			</h:panelGroup>
		</div>
		
		<div class="content-servicos">
			<div class="flex" style="margin-bottom: 16px;">
				<div class="icon-circle" >
					<i class="fa-solid fa-scissors"></i>
				</div>
				<div class="subtitle-info">
					<label class="title-info">Top 5 Serviços do Mês</label>
				</div>
			</div>
			
			<!-- Cards de serviços -->
			<h:panelGroup id="cardsServicos">
				<div class="cardsServicos">
					<ui:repeat value="#{homeController.topServicosMes}" var="servico">
					<div class="servico-card">
						<div class="servico-header">
							<div class="servico-info">
								<span class="servico-nome">#{servico.nome}</span>
								<span class="servico-preco">
									<i class="fa-solid fa-tag"></i>
									#{homeController.formatarPreco(servico.preco)}
								</span>
							</div>
							<div class="servico-quantidade">
								<span class="servico-total">#{servico.total}</span>
								<span class="servico-label">Solicitações</span>
							</div>
						</div>
						
						<div class="servico-barra-container">
							<div class="servico-barra-fill" style="width: #{servico.porcentagem}%;">
								<span class="servico-porcentagem">#{servico.porcentagem}%</span>
							</div>
						</div>
					</div>
				</ui:repeat>
				</div>
				
				
				<!-- Mensagem quando não há serviços -->
				<h:panelGroup rendered="#{empty homeController.topServicosMes}">
					<div class="servicos-vazio">
						<i class="fa-solid fa-chart-simple"></i>
						<p>Nenhum serviço solicitado este mês</p>
					</div>
				</h:panelGroup>
			</h:panelGroup>
		</div>
		
		<script>
		//<![CDATA[
		// Anima as barras de progresso dos serviços ao carregar
		window.addEventListener('load', function() {
			setTimeout(function() {
				var barras = document.querySelectorAll('.servico-barra-fill');
				barras.forEach(function(barra) {
					barra.style.width = barra.style.width;
				});
			}, 300);
		});
		//]]>
		</script>
	</ui:define>

</ui:composition>
</html>
