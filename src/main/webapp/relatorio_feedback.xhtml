<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<!-- Usando o template sem sidebar (2 colunas) -->
<ui:composition template="/WEB-INF/template.xhtml">

	<!-- Título da página -->
	<ui:define name="title">Relatório de Feedback - BarberSys</ui:define>
	
	<!-- CSS específico desta página -->
	<ui:define name="extra-css">
		<h:outputScript library="primefaces" name="locales/locale-pt.js" />
		<style>
.header-filters {
	margin-top: 9px;
}

body .ui-datatable thead tr:not(.ui-datatable-empty-message), 
body .ui-datatable tbody tr:not(.ui-datatable-empty-message) {
	display: grid;
	grid-template-columns: 90px 130px 1.2fr 120px 2fr;
}

body .ui-datatable thead th:first-child:not(.ui-datatable-empty-message),
body .ui-datatable tbody td:first-child:not(.ui-datatable-empty-message),
body .ui-datatable thead th:nth-child(4):not(.ui-datatable-empty-message),
body .ui-datatable tbody td:nth-child(4):not(.ui-datatable-empty-message) {
	text-align: center !important;
}

body .ui-datatable .ui-datatable-data>tr>td[colspan="5"] {
	height: 514px;
	font-size: 17px;
}

body .ui-datatable .ui-datatable-even>td {
	background-color: transparent;
}

.ui-datatable-even {
	background-color: #F6F7FB !important;
}

.btn-exportar {
	background: #E74A46 !important;
	border-color: #E74A46 !important;
	border-radius: 50px !important;
	height: 40px !important;
	padding: 0 20px !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	gap: 8px;
	font-weight: 600 !important;
	font-size: 12px !important;
	color: white !important;
	text-transform: uppercase;
}

.btn-exportar:hover {
	background: #D13A36 !important;
	border-color: #D13A36 !important;
}

.btn-exportar .ui-button-text {
	padding: 0 !important;
}

.btn-exportar .ui-button-icon-left {
	margin-right: 0 !important;
	position: relative !important;
	left: 0 !important;
	top: 3px !important;
}

.btn-limpar {
	background: #6837DF !important;
	border-color: #6837DF !important;
	border-radius: 50px !important;
	height: 46px !important;
	width: 100% !important;
	padding: 0 20px !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	font-weight: 600 !important;
	font-size: 12px !important;
	color: white !important;
	text-transform: uppercase;
}

.btn-limpar:hover {
	background: #5829C7 !important;
	border-color: #5829C7 !important;
}

.btn-limpar .ui-button-text {
	padding: 0 !important;
}

.rating-number {
	color: #E74A46;
	font-size: 1em;
	font-weight: bold;
}

/* Estilo para o datePicker nos filtros */
.input-combined-no-text .p-datepicker,
.input-combined-no-text .ui-calendar,
.input-combined-no-text .p-calendar {
	width: 100% !important;
	position: relative !important;
	display: inline-flex !important;
}

.input-combined-no-text .p-datepicker .p-inputtext,
.input-combined-no-text .p-datepicker input,
.input-combined-no-text .p-calendar input,
.input-combined-no-text .ui-calendar .ui-inputfield {
	height: 46px !important;
	padding-right: 40px !important;
	padding-left: 12px !important;
	width: 100% !important;
	font-size: 14px !important;
	color: #656464 !important;
	font-weight: 600 !important;
	font-family: "Barlow" !important;
	border-radius: 8px !important;
	box-shadow: none !important;
	border: 1px solid #ced4da !important;
}

.input-combined-no-text .p-datepicker-trigger,
.input-combined-no-text .p-datepicker button,
.input-combined-no-text .p-calendar button,
.input-combined-no-text .ui-calendar .ui-button.ui-button-icon-only {
	width: 24px !important;
	height: 24px !important;
	min-width: 24px !important;
	position: absolute !important;
	right: 8px !important;
	top: 50% !important;
	transform: translateY(-50%) !important;
	border-radius: 8px !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	background: #DEDEDE !important;
	border: none !important;
	z-index: 10 !important;
	padding: 0 !important;
}

.input-combined-no-text .p-datepicker-trigger .p-icon,
.input-combined-no-text .p-datepicker button .p-icon,
.input-combined-no-text .p-calendar button .p-icon,
.input-combined-no-text .p-datepicker-trigger svg,
.input-combined-no-text .p-datepicker button svg,
.input-combined-no-text .p-calendar button svg,
.input-combined-no-text .ui-calendar .ui-button.ui-button-icon-only .ui-icon-calendar {
	font-size: 12px !important;
	width: 12px !important;
	height: 12px !important;
	color: black !important;
}

.input-combined-no-text .p-datepicker-trigger:hover,
.input-combined-no-text .p-datepicker button:hover,
.input-combined-no-text .p-calendar button:hover {
	background: #CACACA !important;
}
		</style>
	</ui:define>

	<!-- Conteúdo CENTRAL da página -->
	<ui:define name="content">
	
		<!-- Mensagens de feedback -->
		<p:messages id="messages" showDetail="true" closable="true" />
	
		<!-- Título e Ações -->
		<div class="flex space-between align-items-center">
			<p:outputLabel class="title-page" value="Relatório de Feedback dos Serviços" />
			<p:commandButton 
				value="Exportar"
				icon="fa-solid fa-file-pdf" 
				styleClass="btn-exportar"
				title="Gerar PDF"
				actionListener="#{relatorioFeedbackController.gerarPDF()}"
				ajax="false" />
		</div>

		<!-- Filtros -->
		<div class="header-filters">
			<div class="row">
				<div class="col-md-2 input-combined-no-text">
					<p:selectOneMenu
						value="#{relatorioFeedbackController.avaliacaoFiltro}"
						filter="false"
						panelStyle="width: auto;">
						<f:selectItem itemLabel="Pesquisar Avaliação" itemValue="" />
						<f:selectItem itemLabel="⭐ 1 Estrela" itemValue="1" />
						<f:selectItem itemLabel="⭐⭐ 2 Estrelas" itemValue="2" />
						<f:selectItem itemLabel="⭐⭐⭐ 3 Estrelas" itemValue="3" />
						<f:selectItem itemLabel="⭐⭐⭐⭐ 4 Estrelas" itemValue="4" />
						<f:selectItem itemLabel="⭐⭐⭐⭐⭐ 5 Estrelas" itemValue="5" />
						<p:ajax update="@form" process="@this" />
					</p:selectOneMenu>
				</div>
				<div class="col-md-3 input-combined-no-text">
					<p:selectOneMenu
						value="#{relatorioFeedbackController.funcionarioFiltro}"
						filter="true" 
						filterMatchMode="startsWith"
						panelStyle="width: auto;">
						<f:selectItem itemLabel="Pesquisar Funcionário" itemValue="" />
						<f:selectItems var="func"
							value="#{relatorioFeedbackController.lstFuncionario}"
							itemLabel="#{func.nome}" itemValue="#{func.id}" />
						<p:ajax update="@form" process="@this" />
					</p:selectOneMenu>
				</div>
				<div class="col-md-2 input-combined-no-text">
					<p:datePicker 
						showIcon="true"
						value="#{relatorioFeedbackController.dataInicial}" 
						pattern="dd/MM/yyyy"
						placeholder="Data Inicial">
						<p:ajax update="@form" process="@this" />
					</p:datePicker>
				</div>
				<div class="col-md-2 input-combined-no-text">
					<p:datePicker 
						showIcon="true"
						value="#{relatorioFeedbackController.dataFinal}" 
						pattern="dd/MM/yyyy"
						placeholder="Data Final">
						<p:ajax update="@form" process="@this" />
					</p:datePicker>
				</div>
				<div class="col-md-2">
					<p:commandButton 
						value="Limpar" 
						styleClass="btn-limpar"
						actionListener="#{relatorioFeedbackController.limparFiltros()}"
						update="@form"
						process="@this" />
				</div>
			</div>
		</div>

		<!-- Tabela de Feedbacks -->
		<div>
			<p:dataTable 
				id="datatableFeedbacks"
				value="#{relatorioFeedbackController.lstAvaliacoes}" 
				var="avaliacao"
				rowKey="#{avaliacao.id}"
				paginator="true" 
				paginatorPosition="bottom"
				rows="13" 
				lazy="true" 
				emptyMessage="Nenhum dado encontrado">

				<p:column headerText="Código" style="text-align: center;">
					<h:outputText value="#{avaliacao.id}" />
				</p:column>

				<p:column headerText="Data" style="text-align: center;">
					<h:outputText value="#{avaliacao.dataCriacao}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="Funcionário">
					<h:outputText value="#{avaliacao.funcionario.nome}" />
				</p:column>

				<p:column headerText="Avaliação" style="text-align: center;">
					<span class="rating-number">
						<h:outputText value="#{avaliacao.nota}.0" />
					</span>
				</p:column>

				<p:column headerText="Comentários">
					<h:outputText value="#{avaliacao.comentario}" />
				</p:column>

			</p:dataTable>
		</div>
	
	</ui:define>

</ui:composition>
</html>
