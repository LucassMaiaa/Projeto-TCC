<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<!-- Usando o template SEM sidebar -->
<ui:composition template="/WEB-INF/template.xhtml">

	<!-- Título da página -->
	<ui:define name="title">Cadastro de Funcionários - BarberSys</ui:define>
	
	<!-- CSS específico desta página -->
	<ui:define name="extra-css">
		<h:outputScript library="primefaces" name="locales/locale-pt.js" />
		<style>
.content-info-lateral {
	background: #FCFCFF;
}

.header-filters {
	margin-top: 9px;
}

.perfil-top-funcionario {
	height: 28px;
	width: 28px;
	background-size: cover;
	margin: 0;
}

.dataList-custom.ui-datalist .ui-datalist-content {
	min-height: calc(100vh - 400px);
	max-height: calc(100vh - 400px);
	overflow-y: auto;
}

body .dataList-dialog-custom.ui-datalist .ui-datalist-content {
	min-height: 211px;
	max-height: 300px;
	overflow-y: auto;
}

body .data-list-time.ui-datalist .ui-datalist-content {
	min-height: 211px;
	max-height: 250px;
	overflow-y: auto;
}

body .ui-datalist .ui-datalist-content {
	border: none;
	padding: 0;
}

.dataList-custom.ui-datalist .ui-datalist-empty-message {
	min-height: calc(100vh - 400px);
	display: flex;
	justify-content: center;
	align-items: center;
	font-size: 17px !important;
	font-weight: bold;
}

.data-list-time.ui-datalist .ui-datalist-empty-message {
	min-height: 211px;
	display: flex;
	justify-content: center;
	align-items: center;
	font-size: 14px;
	font-weight: bold;
}
		</style>
	</ui:define>

	<!-- Conteúdo da página -->
	<ui:define name="content">
	
		<!-- Título da página -->
		<div class="flex space-between">
			<p:outputLabel class="title-page" value="Cadastro de Funcionários" />
		</div>

		<div class="header-filters">
			<div class="row">
				<div class="col-md-3 input-combined-no-text">
					<p:inputText value="#{funcionarioController.nomeFuncionario}" autocomplete="off"
						placeholder="Pesquisar funcionário">
						<p:ajax event="keyup" delay="100" update="@form" process="@this" />
					</p:inputText>
					<i class="fa-solid fa-magnifying-glass"></i>
				</div>
				<div class="col-md-4">
					<div class="content-filter ">
						<i class="fa-solid fa-filter"></i>
						<p:selectOneButton
							value="#{funcionarioController.statusSelecionado}"
							unselectable="false">
							<f:selectItem itemLabel="Todos" itemValue="" />
							<f:selectItem itemLabel="Ativos" itemValue="A" />
							<f:selectItem itemLabel="Inativos" itemValue="I" />
							<p:ajax update="@form" process="@this" />
						</p:selectOneButton>
					</div>
				</div>
			</div>
		</div>

		<div class="flex align-center mt15 mb15">
			<p:commandButton
				actionListener="#{funcionarioController.novoFuncionario()}"
				update="form:dlgFunc" process="@this" class="btn-circle-green"
				icon="fa fa-plus" oncomplete="PF('dlgFunc').show()" />
			<label class="title-button ml8">Novo funcionário</label>
		</div>

		<div>
			<p:dataList id="datatableCaixas" rowIndexVar="row"
				class="dataList-custom"
				value="#{funcionarioController.lstFuncionario}" var="funcionario"
				paginator="true" paginatorPosition="bottom" rows="16" lazy="true"
				emptyMessage="Nenhum dado encontrado">
				<p:commandLink
					actionListener="#{funcionarioController.funcionarioSelecionado(funcionario)}"
					update="form:dlgFunc" process="@this"
					oncomplete="PF('dlgFunc').show()">
					<div
						class="card-list #{funcionario.status == 'I' ? 'inativo' : 'ativo'}">
						<div>
							<label class="title-list">Funcionário</label>
							<p:outputLabel styleClass="subtitle-list"
								value="#{funcionario.nome}" />
						</div>
					</div>
				</p:commandLink>
			</p:dataList>
		</div>

		<p:dialog id="dlgFunc" widgetVar="dlgFunc" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<h:panelGroup id="dlgFuncForm">
				<div class="header-modal">
					<div class="flex align-center">
						<div class="icon-circle">
							<ui:fragment rendered="#{funcionarioController.editarModel eq 'A'}">
								<i class="fa-solid fa-pen"></i>
							</ui:fragment>
							<ui:fragment rendered="#{funcionarioController.editarModel eq 'I'}">
								<i class="fa-solid fa-user-plus"></i>
							</ui:fragment>
						</div>
						<label>#{funcionarioController.editarModel eq 'A' ?
							'Editar Funcionário' : 'Novo Funcionário'}</label>
					</div>
					<div class="flex align-center">
						<ui:fragment
							rendered="#{funcionarioController.editarModel eq 'A'}">
							<p:commandButton update="dttLstHorariosAux" process="@this"
								styleClass="btn-trash" onclick="PF('dlgConfirm').show()"
								icon="fa-solid fa-trash" />
							<p:commandButton update="dlgFuncForm" process="@form"
								actionListener="#{funcionarioController.atualizarFuncionario()}"
								styleClass="btn btn-green" value="Salvar" />
						</ui:fragment>
						<ui:fragment
							rendered="#{funcionarioController.editarModel eq 'I'}">
							<p:commandButton update="dlgFuncForm" process="@form"
								actionListener="#{funcionarioController.adicionarNovoFuncionario()}"
								styleClass="btn btn-green" value="Salvar" />
						</ui:fragment>

						<p:commandButton styleClass="btn-x" icon="fa-solid fa-xmark"
							onclick="PF('dlgFunc').hide()"
							actionListener="#{funcionarioController.limpaListaHorario()}" />
					</div>

				</div>

				<div class="row">
					<div class="col-md-4">
						<div class="content-filter no-filter">
							<p:selectOneButton
								value="#{funcionarioController.funcionarioModel.status}"
								unselectable="false">
								<f:selectItem itemLabel="Ativo" itemValue="A" />
								<f:selectItem itemLabel="Inativo" itemValue="I" />
								<p:ajax update="@this" process="@this" />
							</p:selectOneButton>
						</div>
					</div>
				</div>


				<p:messages id="msgs" closable="true" showIcon="true"
					autoUpdate="true" />

                <div class="row">
					<div class="col-md-6">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input"
								value="Login" />
							<p:inputText styleClass="senha-login" autocomplete="off"
								value="#{funcionarioController.funcionarioModel.usuario.login}" />
						</div>
					</div>
                    <div class="col-md-6">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input"
								value="Senha" />
							<p:password styleClass="senha-login" autocomplete="off"
								value="#{funcionarioController.funcionarioModel.usuario.senha}"
								placeholder="#{funcionarioController.editarModel eq 'A' and funcionarioController.funcionarioModel.usuario.id != null ? 'Criar nova senha' : ''}" />
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-md-12">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input"
								value="Nome do funcionário" />
							<p:inputText styleClass="senha-login"
								value="#{funcionarioController.funcionarioModel.nome}" />
						</div>
					</div>
				</div>

				<div class="row flex align-center">
					<div class="col-5">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Ínicio" />
							<p:datePicker id="inputHoraInicio" timeOnly="true"
								validatorMessage="Hora inicial inválida. Use o formato HH:mm."
								pattern="HH:mm" value="#{funcionarioController.dataInicial}"
								styleClass="senha-login" />
						</div>
					</div>

					<div class="col-5">
						<div class="input-combined">
							<p:outputLabel styleClass="title-input" value="Fim" />
							<p:datePicker id="inputHoraFim" timeOnly="true"
								validatorMessage="Hora final inválida. Use o formato HH:mm."
								pattern="HH:mm" value="#{funcionarioController.dataFinal}"
								styleClass="senha-login" />
						</div>
					</div>

					<div class="col-2">
						<p:commandButton update="dttLstHorarios dlgFuncForm"
							process="@form"
							actionListener="#{funcionarioController.novoHorario()}"
							class="btn btn-green" value="Adicionar" />
					</div>
				</div>
				
				<label class="title-item mt30 mb25">Horários de Trabalho</label>

				<ui:fragment rendered="#{funcionarioController.editarModel eq 'I'}">
					<p:dataList id="dttLstHorariosAux" paginator="true"
						paginatorPosition="bottom" rows="4"
						class="dataList-dialog-custom data-list-time"
						value="#{funcionarioController.lstHorarioAux}"
						emptyMessage="Nenhum horário adicionado" var="horario"
						rowIndexVar="index">

						<div class="list-time">
							<div>
								<i class="fa-solid fa-clock"></i>
								<div>
									<label class="title-obj">Inicial</label> <label
										class="subtitle-obj">#{horario.horaInicial}</label>
								</div>
								<div>
									<label>-</label>
								</div>
								<div>
									<label class="title-obj">Final</label> <label
										class="subtitle-obj">#{horario.horaFinal}</label>
								</div>
							</div>

							<p:commandButton update="dttLstHorariosAux" process="@this"
								styleClass="btn-trash"
								actionListener="#{funcionarioController.recebeValorDeleteHorarioAux(index)}"
								icon="fa-solid fa-trash" />
						</div>

					</p:dataList>
				</ui:fragment>
				<ui:fragment rendered="#{funcionarioController.editarModel eq 'A'}">
					<p:dataList id="dttLstHorarios" rowIndexVar="row"
						class="dataList-dialog-custom data-list-time"
						value="#{funcionarioController.lstHorarios}" var="horario"
						paginator="true" paginatorPosition="bottom" rows="4" lazy="true"
						emptyMessage="Nenhum horário cadastrado para esse funcionário">

						<div class="list-time">
							<div>
								<i class="fa-solid fa-clock"></i>
								<div>
									<label class="title-obj">Inicial</label> <label
										class="subtitle-obj">#{horario.horaInicial}</label>
								</div>
								<div>
									<label>-</label>
								</div>
								<div>
									<label class="title-obj">Final</label> <label
										class="subtitle-obj">#{horario.horaFinal}</label>
								</div>
							</div>

							<p:commandButton update="dttLstHorarios" process="@this"
								styleClass="btn-trash"
								actionListener="#{funcionarioController.recebeValorDeleteHorario(horario)}"
								icon="fa-solid fa-trash" />
						</div>


					</p:dataList>
				</ui:fragment>

			</h:panelGroup>

		</p:dialog>

		<p:dialog id="dlgConfirm" widgetVar="dlgConfirm" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<h:panelGroup id="dlgConfirmForm">
				<div class="header-modal-confirm">
					<div>
						<label>Realmente deseja excluir esse funcionário?</label>
					</div>
				</div>

				<div class="flex align-center justify-center">
					<p:commandButton styleClass="btn medium btn-confirm"
						value="Confirmar"
						actionListener="#{funcionarioController.deletaFuncionario()}" />
					<p:commandButton styleClass="btn medium btn-cancel"
						value="Cancelar" onclick="PF('dlgConfirm').hide()" />
				</div>

			</h:panelGroup>

		</p:dialog>

		<p:dialog id="dlgHora" widgetVar="dlgHora" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<div class="header-modal-confirm">
				<div>
					<label>Realmente deseja excluir esse horário?</label>
				</div>
			</div>

			<div class="flex align-center justify-center">
				<p:commandButton styleClass="btn medium btn-confirm"
					value="Confirmar"
					actionListener="#{funcionarioController.deletaHorario()}" 
					process="@this"
					update="form:dlgFuncForm"/>
				<p:commandButton styleClass="btn medium btn-cancel" value="Cancelar"
					onclick="PF('dlgHora').hide()" />
			</div>

		</p:dialog>

		<p:dialog id="dlgHoraAux" widgetVar="dlgHoraAux" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<div class="header-modal-confirm">
				<div>
					<label>Realmente deseja excluir esse horário?</label>
				</div>
			</div>

			<div class="flex align-center justify-center">
				<p:commandButton styleClass="btn medium btn-confirm"
					value="Confirmar"
					actionListener="#{funcionarioController.deletaHorarioAux()}" />
				<p:commandButton styleClass="btn medium btn-cancel" value="Cancelar"
					onclick="PF('dlgHoraAux').hide()" />
			</div>
		</p:dialog>
		
	</ui:define>

</ui:composition>
</html>