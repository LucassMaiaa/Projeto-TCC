<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="/WEB-INF/template-with-sidebar.xhtml">

	<ui:define name="title">Agendamento Cliente - BarberSys</ui:define>
	
	<ui:define name="extra-css">
		<style>
		.content-top-visitas {
			border: 1px solid #DDE3DF;
			height: 281px;
			border-radius: 8px;
			padding: 14px 25px;
		}
		
		.content-gastos-mes {
			background-color: #C5D9BF;
			height: 281px;
			border-radius: 8px;
			padding: 14px 25px;
		}
		
		.content-faturado {
			border-radius: 8px;
			background: #D8E0E8;
			padding: 14px 25px;
		}
		
		.content-top-func {
			border: 1px solid #DDE3DF;
			border-radius: 8px;
			padding: 14px 25px;
		}
		
		.content-logo-system {
			height: 132px;
			width: 100%;
			background: #F5F5F7;
			background-image: url('resources/images/logo-com-imagem.svg');
			background-repeat: no-repeat;
			background-position: center top;
		}
		
		.content-btns {
			width: 100%;
			height: 54px;
			display: flex;
			justify-content: center;
			padding: 8px;
		}
		
		/* ===== SIDEBAR DE AGENDAMENTOS - DESIGN MODERNO ===== */
		.content-agendamentos {
			height: 100vh;
			background: #FCFCFF;
			border-radius: 8px 8px 0 0;
			padding: 24px 20px;
			display: flex;
			flex-direction: column;
			overflow: hidden;
			font-family: 'Barlow', sans-serif;
		}
		
		/* Header mant√©m o padr√£o do sistema */
		.content-agendamentos .flex {
			flex-shrink: 0;
		}
		
		/* Container da lista com scroll */
		.appointment-list {
			flex: 1;
			overflow-y: auto;
			overflow-x: hidden;
			padding-right: 6px;
		}
		
		/* Scrollbar minimalista */
		.appointment-list::-webkit-scrollbar {
			width: 4px;
		}
		
		.appointment-list::-webkit-scrollbar-track {
			background: transparent;
		}
		
		.appointment-list::-webkit-scrollbar-thumb {
			background: #D1D5DB;
			border-radius: 10px;
		}
		
		.appointment-list::-webkit-scrollbar-thumb:hover {
			background: #9CA3AF;
		}
		
		/* Card moderno sem bordas */
		.appointment-card {
			background: #FFFFFF;
			border-radius: 16px;
			margin-bottom: 16px;
			overflow: hidden;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}
		
		.appointment-card:hover {
			box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
			transform: translateY(-2px);
		}
		
		/* Anima√ß√£o de entrada suave */
		@keyframes fadeInUp {
			from {
				opacity: 0;
				transform: translateY(15px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		
		.appointment-card {
			animation: fadeInUp 0.5s ease-out backwards;
		}
		
		.appointment-card:nth-child(1) { animation-delay: 0.05s; }
		.appointment-card:nth-child(2) { animation-delay: 0.1s; }
		.appointment-card:nth-child(3) { animation-delay: 0.15s; }
		.appointment-card:nth-child(4) { animation-delay: 0.2s; }
		.appointment-card:nth-child(5) { animation-delay: 0.25s; }
		
		/* Header do card - Data e Hor√°rio */
		.card-header {
			background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%);
			padding: 16px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		
		/* Badge da data */
		.date-badge {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			background: rgba(255, 255, 255, 0.2);
			backdrop-filter: blur(10px);
			border-radius: 12px;
			padding: 8px 12px;
			min-width: 60px;
		}
		
		.date-badge .day {
			font-size: 24px;
			font-weight: 700;
			color: #FFFFFF;
			line-height: 1;
			letter-spacing: -0.5px;
		}
		
		.date-badge .month {
			font-size: 12px;
			font-weight: 600;
			color: rgba(255, 255, 255, 0.9);
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-top: 2px;
		}
		
		/* Badge do hor√°rio */
		.time-badge {
			display: flex;
			align-items: center;
			gap: 8px;
			background: rgba(255, 255, 255, 0.2);
			backdrop-filter: blur(10px);
			padding: 10px 16px;
			border-radius: 20px;
		}
		
		.time-badge i {
			font-size: 16px;
			color: #FFFFFF;
		}
		
		.time-badge span {
			font-size: 18px;
			font-weight: 700;
			color: #FFFFFF;
			letter-spacing: 0.5px;
		}
		
		/* Corpo do card */
		.card-body {
			padding: 16px;
			display: flex;
			flex-direction: column;
			gap: 12px;
		}
		
		/* Linha de informa√ß√£o */
		.info-row {
			display: flex;
			align-items: center;
			gap: 10px;
			font-size: 14px;
			color: #374151;
		}
		
		.info-row i {
			font-size: 14px;
			color: #6366F1;
			min-width: 16px;
		}
		
		.info-row span {
			font-weight: 500;
			line-height: 1.4;
		}
		
		.info-row.services span {
			color: #6B7280;
			font-size: 13px;
		}
		
		/* Footer do card */
		.card-footer {
			padding: 12px 16px;
			background: #F9FAFB;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		
		.appointment-meta {
			display: flex;
			align-items: center;
			gap: 12px;
		}
		
		.appointment-meta-item {
			display: flex;
			align-items: center;
			gap: 6px;
			padding: 6px 10px;
			border-radius: 8px;
			font-size: 13px;
			font-weight: 600;
		}
		
		.appointment-meta-item.price {
			background-color: rgba(16, 185, 129, 0.1);
			color: #059669;
		}
		
		.appointment-meta-item.duration {
			background-color: rgba(99, 102, 241, 0.1);
			color: #4F46E5;
		}
		
		.appointment-meta-item i {
			font-size: 12px;
		}
		
		/* Bot√£o de cancelar moderno */
		.btn-cancel-appointment {
			background: transparent !important;
			border: 1px solid #EF4444 !important;
			color: #EF4444 !important;
			font-size: 13px !important;
			font-weight: 600 !important;
			padding: 8px 11px 8px 28px !important;
			border-radius: 10px !important;
			transition: all 0.3s ease !important;
			font-family: 'Barlow', sans-serif !important;
		}
		
		.btn-cancel-appointment:hover {
			background: #EF4444 !important;
			color: #FFFFFF !important;
			transform: translateY(-1px) !important;
			box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3) !important;
		}
		
		.btn-cancel-appointment:active {
			transform: translateY(0) !important;
		}
		
		.btn-cancel-appointment .ui-button-icon-left {
			font-size: 12px !important;
			margin-right: 6px !important;
		}
		
		.btn-cancel-appointment .ui-button-text {
			line-height: 1 !important;
		}
		
		/* Mensagem vazia moderna */
		body .ui-datalist-noborder .ui-datalist-empty-message {
			padding: 60px 20px;
			text-align: center;
			color: #9CA3AF;
			font-size: 14px;
			font-weight: 500;
			    top: 28vh;
		    position: relative;
		}
		
		body .ui-datalist-noborder .ui-datalist-empty-message::before {
			content: 'üìÖ';
			display: block;
			font-size: 48px;
			margin-bottom: 12px;
			opacity: 0.5;
		}
		
		/* Remove estilos padr√£o do PrimeFaces */
		body .ui-datalist-noborder {
			border: none !important;
			background: transparent !important;
		}
		
		body .ui-datalist-noborder .ui-datalist-content {
			border: none !important;
			background: transparent !important;
			padding: 0 !important;
		}
		
		.no-filter {
		    margin-bottom: 15px;
		    flex-grow: 1;
		    margin-left: 20px;
		}
		
		/* ===== SERVI√áOS DISPON√çVEIS - ESTILO CONFORME IMAGEM ===== */
		
		.services-section-cliente {
			margin-top: 30px;
		}
		
		/* Header com t√≠tulo e valor total */
		.services-header-cliente {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}
		
		.services-title-cliente {
			font-size: 20px;
			font-weight: bold;
			color: #000;
			margin: 0;
			font-family: 'Barlow', sans-serif;
		}
		
		.services-total-cliente {
		    background: linear-gradient(135deg, #10B981 0%, #10B981 100%);
		    padding: 10px 20px;
		    border-radius: 8px;
		    box-shadow: 0 2px 8px #10b98173;
		    font-size: 14px;
		    font-weight: 600;
		    color: #FFF;
		    letter-spacing: 0.3px;
		}
		
		.total-value-cliente {
			font-weight: 700;
			font-size: 16px;
			color: #FFF;
			margin-left: 5px;
		}
		
		/* Grid de servi√ßos - 3 colunas */
		.services-grid-cliente {
			    margin-bottom: 30px;
		    max-height: 233px;
		    overflow: auto;
		}
		
		body .services-datagrid-cliente.ui-datagrid {
			background: transparent;
			border: none;
		}
		
		body .services-datagrid-cliente .ui-datagrid-content {
			background: transparent;
			border: none;
			padding: 0;
		}
		
		body .services-datagrid-cliente .ui-g {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
			margin: 0;
		}
		
		body .services-datagrid-cliente .ui-g-12 {
			padding: 0;
			margin: 0;
			width: 100%;
		}
		
		.services-datagrid-cliente .ui-datagrid-empty-message {
		    grid-column: 1 / -1; /* Span all columns in the grid */
		    text-align: center;
		    padding: 80px 20px;
		    color: #9CA3AF;
		    font-size: 16px;
		    font-weight: 600;
		}
		.services-datagrid-cliente .ui-datagrid-empty-message::before {
		    content: 'üö´'; /* Using a different icon */
		    display: block;
		    font-size: 48px;
		    margin-bottom: 12px;
		    opacity: 0.5;
		}
		
		/* Card de servi√ßo - estilo da imagem */
		.service-card-cliente {
			background: #EBEBEB;
			border-radius: 8px;
			padding: 10px;
			display: flex;
			align-items: center;
			gap: 12px;
			cursor: pointer;
			transition: all 0.2s ease;
			border: 2px solid transparent;
			min-height: 70px;
		}
		
		.service-card-cliente:hover:not(.disabled) {
			background: #DCDCDC;
			border-color: #C0C0C0;
		}
		
		.service-card-cliente.disabled {
			opacity: 0.6;
			cursor: not-allowed;
		}
		
		/* Checkbox customizado */
		.service-card-cliente .ui-chkbox {
			margin-top: 3px;
		}
		
		.service-card-cliente .ui-chkbox .ui-chkbox-box {
			width: 20px;
			height: 20px;
			border: 2px solid #666;
			border-radius: 4px;
			background: #FFF;
		}
		
		.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-active {
			background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
			border-color: #6366F1 !important;
		}
		
		/* Remove TODOS os hovers do checkbox */
		.service-card-cliente .ui-chkbox .ui-chkbox-box:hover,
		.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-hover,
		.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-active:hover,
		.service-card-cliente .ui-chkbox .ui-chkbox-box.ui-state-active.ui-state-hover {
			background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);
			border-color: #6366F1 !important;
		}
		
		.service-card-cliente .ui-chkbox .ui-chkbox-box:not(.ui-state-active):hover,
		.service-card-cliente .ui-chkbox .ui-chkbox-box:not(.ui-state-active).ui-state-hover {
			background: #FFF !important;
			border-color: #666 !important;
		}
		
		.service-card-cliente .ui-chkbox .ui-chkbox-box .ui-chkbox-icon {
			color: #FFF;
			top: 4px;
		}
		
		/* Informa√ß√µes do servi√ßo */
		.service-info-cliente {
			display: flex;
			flex-direction: column;
			gap: 4px;
			flex: 1;
			cursor: pointer;
		}
		
		ul {
		    list-style: none;
		    padding: 0;
		}
		
		.service-name-cliente {
			font-size: 12px;
			font-weight: 600;
			color: #5A5A5A;
			text-transform: uppercase;
			letter-spacing: 0.3px;
			line-height: 1.2;
		}
		
		.service-price-cliente {
			font-size: 17px;
			font-weight: bold;
			color: #000;
			line-height: 1;
		}
		
		.service-duration-cliente {
		    font-size: 14px !important;
		    font-weight: 700 !important;
		    color: #4F46E5 !important;
		    background-color: rgba(99, 102, 241, 0.1);
		    padding: 4px 8px;
		    border-radius: 6px;
		    display: flex;
		    align-items: center;
		    gap: 6px;
		    border: 1px solid rgba(99, 102, 241, 0.2);
		}

		.service-duration-cliente i {
		    color: #4F46E5 !important;
		}
		
		/* Footer com bot√£o AGENDAR */
		.footer-actions-cliente {
			display: flex;
			justify-content: center;
			margin-top: 30px;
		}
		
		.btn-agendar-cliente {
			background: #4CAF50 !important;
			border: none !important;
			color: #FFF !important;
			font-size: 12px !important;
			font-weight: bold !important;
			text-transform: uppercase;
			padding: 15px 80px !important;
			border-radius: 50px !important;
			cursor: pointer;
		}
		
		.btn-agendar-cliente:hover {
			background: #45A049 !important;
			box-shadow: 0 6px 12px rgba(76, 175, 80, 0.4);
			transform: translateY(-2px);
		}
		
		.btn-agendar-cliente:active {
			transform: translateY(0);
			box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
		}
		
		/* ===== STEPS E ANIMA√á√ïES ===== */
		
		/* Bot√£o inicial "Realizar novo agendamento" */
		.btn-iniciar-agendamento {
			background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%) !important;
			border: none !important;
			color: #FFF !important;
			font-size: 16px !important;
			font-weight: 700 !important;
			padding: 20px 40px !important;
			border-radius: 50px !important;
			cursor: pointer !important;
			box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3) !important;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
			text-transform: uppercase !important;
			letter-spacing: 1px !important;
		}
		
		.btn-iniciar-agendamento:hover {
			transform: translateY(-3px) !important;
			box-shadow: 0 12px 32px rgba(99, 102, 241, 0.4) !important;
		}
		
		.btn-iniciar-agendamento:active {
			transform: translateY(-1px) !important;
		}
		
		.btn-iniciar-container {
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 400px;
			animation: fadeIn 0.6s ease-out;
		}
		
		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: scale(0.95);
			}
			to {
				opacity: 1;
				transform: scale(1);
			}
		}
		
		@keyframes fadeOut {
			from {
				opacity: 1;
				transform: scale(1);
			}
			to {
				opacity: 0;
				transform: scale(0.95);
			}
		}
		
		.fade-out {
			animation: fadeOut 0.3s ease-out forwards;
		}
		
		/* Steps customizados */
		body .ui-steps {
			background: transparent !important;
			border: none !important;
			margin-bottom: 30px !important;
		}
		
		body .ui-steps .ui-steps-item {
			background: transparent !important;
		}
		
		body .ui-steps .ui-steps-item .ui-menuitem-link {
			background: transparent !important;
			padding: 1rem !important;
			border: none !important;
			transition: all 0.3s ease !important;
		}
		
		body .ui-steps .ui-steps-item .ui-steps-number {
			background: #E5E7EB !important;
			color: #6B7280 !important;
			border: 3px solid #E5E7EB !important;
			width: 40px !important;
			height: 40px !important;
			line-height: 34px !important;
			font-size: 16px !important;
			font-weight: 700 !important;
			box-shadow: none !important;
			transition: all 0.4s ease !important;
		}
		
		body .ui-steps .ui-steps-item.ui-state-highlight .ui-steps-number {
			background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%) !important;
			color: #FFFFFF !important;
			border-color: #6366F1 !important;
			box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3) !important;
			transform: scale(1.1);
		}
		
		body .ui-steps .ui-steps-item .ui-steps-title {
			color: #6B7280 !important;
			font-weight: 600 !important;
			font-size: 14px !important;
			margin-top: 8px !important;
			transition: all 0.4s ease !important;
		}
		
		body .ui-steps .ui-steps-item.ui-state-highlight .ui-steps-title {
			color: #6366F1 !important;
		}
		
		/* Conte√∫do dos steps */
		.step-content {
			animation: step-enter-animation 0.5s ease-out;
			padding: 20px 0;
		}
		
		@keyframes step-enter-animation {
			from {
				opacity: 0;
				transform: translateY(15px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		
		/* Bot√µes de navega√ß√£o dos steps */
		.step-buttons {
			display: flex;
			justify-content: space-between;
			margin-top: 30px;
			gap: 15px;
		}
		
		.btn-step {
			padding: 12px 30px !important;
			font-size: 14px !important;
			font-weight: 600 !important;
			border-radius: 40px !important;
			transition: all 0.3s ease !important;
			text-transform: uppercase !important;
			letter-spacing: 0.5px !important;
		}
		
		.btn-step-previous {
			background: #F3F4F6 !important;
			border: 1px solid #E5E7EB !important;
			color: #374151 !important;
		}
		
		.btn-step-previous:hover {
			background: #E5E7EB !important;
			transform: translateY(-2px) !important;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
		}
		
		.btn-step-next {
			background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%) !important;
			border: none !important;
			color: #FFFFFF !important;
		}
		
		.btn-step-next:hover {
			transform: translateY(-2px) !important;
			box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4) !important;
		}
		
		.btn-step-finish {
			background: linear-gradient(135deg, #10B981 0%, #059669 100%) !important;
			border: none !important;
			color: #FFFFFF !important;
		}
		
		.btn-step-finish:hover:not(:disabled) {
			transform: translateY(-2px) !important;
			box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4) !important;
		}
		
		.btn-step:disabled {
			opacity: 0.5 !important;
			cursor: not-allowed !important;
		}
		
		.btn-step-next:disabled {
			background: #D1D5DB !important;
		}
		
		.btn-step-finish:disabled {
			background: #D1D5DB !important;
		}
		
		body .ui-state-disabled {
		    opacity: 0.6 !important; /* Ajustado para maior visibilidade */
		}

		/* Ajuste espec√≠fico para datas desabilitadas no DatePicker */
		.ui-datepicker .ui-state-disabled {
			opacity: 0.3 !important;
		}
				
		/* Layout dos steps em grid */
		.step-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 20px;
			margin: 20px 0;
		}
		
		.step-grid-full {
			grid-column: 1 / -1;
		}
		
		/* Campo de observa√ß√µes */
		.observacoes-field {
			margin-top: 20px;
		}
		
		.observacoes-field .ui-inputtextarea {
			width: 100% !important;
			min-height: 100px !important;
			border: 2px solid #E5E7EB !important;
			border-radius: 8px !important;
			padding: 12px !important;
			font-size: 14px !important;
			transition: all 0.3s ease !important;
		}
		
		.observacoes-field .ui-inputtextarea:focus {
			border-color: #6366F1 !important;
			box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
		}
		
		/* Ajuste no scrollbar da grid de servi√ßos */
		.services-grid-cliente::-webkit-scrollbar {
			width: 6px;
		}
		
		.services-grid-cliente::-webkit-scrollbar-track {
			background: #F3F4F6;
			border-radius: 10px;
		}
		
		.services-grid-cliente::-webkit-scrollbar-thumb {
			background: #D1D5DB;
			border-radius: 10px;
		}
		
		.services-grid-cliente::-webkit-scrollbar-thumb:hover {
			background: #9CA3AF;
		}
		</style>

	</ui:define>

	<ui:define name="content">

		<p:outputPanel id="bookingAreaPanel">
			<div class="booking-area"
				style="padding: 20px; background-color: #FCFCFF; border-radius: 8px">
				<div class="logo" style="text-align: center; margin-bottom: 20px;">
					<img class="img-custom"
						src="#{request.contextPath}/resources/images/logo-agend-cliente.svg" />
				</div>

				<p:messages id="msgs" closable="true" showIcon="true" />

				<!-- Bot√£o inicial para come√ßar agendamento -->
				<h:panelGroup rendered="#{not agendamentoClienteController.agendamentoIniciado}">
					<div class="btn-iniciar-container" style="text-align: center; padding: 40px 0;">
						<p:commandButton value="Realizar Novo Agendamento" 
							styleClass="btn-iniciar-agendamento"
							action="#{agendamentoClienteController.iniciarAgendamento}"
							update=":form:bookingAreaPanel :form:msgs"
							process="@this"
							ajax="true" />
					</div>
				</h:panelGroup>

				<!-- Steps do agendamento -->
				<h:panelGroup id="stepsContainer" rendered="#{agendamentoClienteController.agendamentoIniciado}">
					<p:steps id="stepsComponent" 
						activeIndex="#{agendamentoClienteController.activeIndex}" 
						widgetVar="stepsWV"
						styleClass="custom-steps"
						readonly="true">
						<p:menuitem value="Cliente e Funcion√°rio" />
						<p:menuitem value="Data e Servi√ßos" />
						<p:menuitem value="Hor√°rio e Observa√ß√µes" />
					</p:steps>

					<!-- Passo 1: Cliente e Funcion√°rio -->
					<h:panelGroup rendered="#{agendamentoClienteController.activeIndex == 0}">
						<div class="step-content">
							<div class="step-grid">
								<p:outputPanel id="panelCliente">
									<div class="input-combined">
										<p:outputLabel styleClass="title-input" value="Nome do cliente" />
										<p:inputText id="nomeProprioInput"
											value="#{agendamentoClienteController.nomeClienteLogado}"
											disabled="true" />
									</div>
								</p:outputPanel>

								<p:outputPanel id="barberSelectorWrapper">
									<div class="input-combined">
										<p:outputLabel styleClass="title-input"
											value="Nome do funcion√°rio" />
										<p:selectOneMenu id="barberSelector"
											value="#{agendamentoClienteController.funcionarioId}"
											required="true"
											requiredMessage="O campo funcion√°rio √© obrigat√≥rio."
											filter="true" filterMatchMode="startsWith"
											disabled="#{agendamentoClienteController.funcionarioDesabilitado}">
											<f:selectItem itemLabel="Selecione um funcion√°rio" itemValue="" />
											<f:selectItems
												value="#{agendamentoClienteController.funcionariosDisponiveis}"
												var="func" itemLabel="#{func.nome}" itemValue="#{func.id}" />
											<p:ajax event="change"
												listener="#{agendamentoClienteController.aoSelecionarFuncionario}"
												update=":form:btnProximoPasso1"
												process="@this"/>
										</p:selectOneMenu>
									</div>
								</p:outputPanel>
							</div>

							<!-- Bot√µes do Passo 1 -->
							<div class="step-buttons">
								<div></div>
								<p:commandButton id="btnProximoPasso1" value="Pr√≥ximo" 
									styleClass="btn-step btn-step-next"
									action="#{agendamentoClienteController.proximoPasso}"
									disabled="#{not agendamentoClienteController.podeAvancarPasso}"
									update=":form:stepsContainer :form:msgs"
									process="@this :form:panelCliente :form:barberSelectorWrapper"
									ax="true" />
							</div>
						</div>
					</h:panelGroup>

					<!-- Passo 2: Data e Servi√ßos -->
					<h:panelGroup rendered="#{agendamentoClienteController.activeIndex == 1}">
						<div class="step-content">
							
							<p:outputPanel id="datePickerWrapper" style="margin-bottom: 20px;">
								<div class="input-combined">
									<p:outputLabel styleClass="title-input"
										value="Data do Agendamento" />
									<p:datePicker id="datePicker" widgetVar="wvDatePicker"
										value="#{agendamentoClienteController.dataSelecionada}"
										showIcon="true" pattern="dd/MM/yyyy"
										mindate="#{agendamentoClienteController.today}"
										disabledDates="#{agendamentoClienteController.datasDesabilitadasDate}"
										required="true" requiredMessage="O campo Data √© obrigat√≥rio."
										disabled="#{agendamentoClienteController.dataDesabilitada}"
										locale="pt"
										onkeydown="return false;">
										<p:ajax event="dateSelect"
											listener="#{agendamentoClienteController.aoSelecionarData}"
											update=":form:btnProximoPasso2"
											process="@this" />
									</p:datePicker>
								</div>
							</p:outputPanel>
							
							<!-- Servi√ßos em grid - Passo 2 -->
							<p:outputPanel id="servicosWrapper" styleClass="step-grid-full">
								<div class="services-section-cliente">
									<div class="services-header-cliente">
										<p:outputPanel id="totalPriceOutput" styleClass="total-update" style="width: 100%;">
											<div style="display: flex; gap: 12px; margin-bottom: 16px;">
												<div style="width: 50%; padding: 12px 16px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 10px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);">
													<div style="display: flex; align-items: center; gap: 10px;">
														<div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; min-width: 32px; height: 32px;">
															<i class="fa-solid fa-dollar-sign" style="color: #FFFFFF; font-size: 14px;"></i>
														</div>
														<div style="flex: 1;">
															<div style="font-size: 10px; color: rgba(255,255,255,0.95); font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 2px;">Valor Total</div>
															<div style="font-size: 18px; color: #FFFFFF; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.1);"> 
																R$ <h:outputText value="#{agendamentoClienteController.valorTotalFormatado}" />
															</div>
														</div>
													</div>
												</div>
												<div style="width: 50%; padding: 12px 16px; background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%); border-radius: 10px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);">
												<div style="display: flex; align-items: center; gap: 10px;">
													<div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; min-width: 32px; height: 32px;">
														<i class="fa-regular fa-clock" style="color: #FFFFFF; font-size: 14px;"></i>
													</div>
														<div style="flex: 1;">
														<div style="font-size: 10px; color: rgba(255,255,255,0.95); font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 2px;">Tempo Total</div>
															<div style="font-size: 18px; color: #FFFFFF; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">
																#{agendamentoClienteController.tempoTotalFormatado}
															</div>
														</div>
													</div>
												</div>
											</div>
										</p:outputPanel>
									</div>

									<h3 class="services-title-cliente" style="margin-top: 24px; margin-bottom: 16px;">Servi√ßos dispon√≠veis</h3>

									<!-- Campo de pesquisa de servi√ßos -->
									<div class="input-combined-no-text" style="margin-bottom: 16px;">
										<p:inputText id="filtroServico"
											value="#{agendamentoClienteController.filtroServico}"
											placeholder="Pesquisar servi√ßos..."
											autocomplete="off">
											<p:ajax event="keyup" delay="300"
												listener="#{agendamentoClienteController.filtrarServicos}"
												update="servicosGridPanel"
												process="@this" />
										</p:inputText>
										<i class="fa-solid fa-magnifying-glass"></i>
									</div>

									<p:outputPanel id="servicosGridPanel">
										<div class="services-grid-cliente">
											<p:dataGrid var="servico"
												value="#{agendamentoClienteController.servicosParaExibir}"
												columns="3" layout="grid"
												styleClass="services-datagrid-cliente"
												emptyMessage="Nenhum servi√ßo encontrado com os filtros aplicados.">

												<div class="service-card-cliente"
													onclick="document.getElementById('form:chk_#{servico.id}').click();">

													<p:selectBooleanCheckbox 
														id="chk_#{servico.id}"
														value="#{agendamentoClienteController.servicosSelecionadosMap[servico.id]}">
														<p:ajax event="change"
															listener="#{agendamentoClienteController.aoSelecionarServico}"
														update="@(.total-update) :form:btnProximoPasso2" 
														process="@this" />
													</p:selectBooleanCheckbox>

													<div class="service-info-cliente">
														<h:outputText value="#{servico.nome}"
															styleClass="service-name-cliente" />

														<div style="display: flex; align-items: center; gap: 12px; margin-top: 10px;">
															<span class="service-price-cliente"> 
																R$ <h:outputText value="#{servico.preco}">
																	<f:convertNumber pattern="0.00" groupingUsed="false" />
																</h:outputText>
															</span>
															
															<span class="service-duration-cliente">
																<i class="pi pi-clock"></i>
																#{agendamentoClienteController.formatarDuracaoServico(servico.minutos)}
															</span>
														</div>
													</div>

												</div>
											</p:dataGrid>
										</div>
									</p:outputPanel>

								</div>
							</p:outputPanel>

							<!-- Bot√µes do Passo 2 -->
							<div class="step-buttons">
								<p:commandButton value="Anterior" 
									styleClass="btn-step btn-step-previous"
									action="#{agendamentoClienteController.passoAnterior}"
									update=":form:stepsContainer"
									process="@this"
									ax="true" />
								<p:commandButton id="btnProximoPasso2" value="Pr√≥ximo" 
									styleClass="btn-step btn-step-next"
									action="#{agendamentoClienteController.proximoPasso}"
									disabled="#{not agendamentoClienteController.podeAvancarPasso}"
									update=":form:stepsContainer :form:msgs"
									process="@this :form:datePickerWrapper :form:servicosWrapper"
									ax="true" />
							</div>
						</div>
					</h:panelGroup>

					<!-- Passo 3: Hor√°rio e Observa√ß√µes -->
					<h:panelGroup rendered="#{agendamentoClienteController.activeIndex == 2}">
						<div class="step-content">
							<div class="step-grid">
								<p:outputPanel id="horarioWrapper" styleClass="total-update">
									<div class="input-combined">
										<p:outputLabel styleClass="title-input"
											value="Selecione o Hor√°rio" />
										<p:selectOneMenu id="horarioSelector"
											value="#{agendamentoClienteController.horaSelecionada}"
											required="true"
											requiredMessage="O campo Hor√°rio √© obrigat√≥rio."
											disabled="#{agendamentoClienteController.horarioDesabilitado or empty agendamentoClienteController.horariosDisponiveis}">
											<f:selectItem itemLabel="#{empty agendamentoClienteController.horariosDisponiveis ? 'Nenhum hor√°rio dispon√≠vel' : 'Selecione um hor√°rio'}" itemValue="" />
											<f:selectItems
												value="#{agendamentoClienteController.horariosDisponiveis}"
												var="h" itemLabel="#{h}" itemValue="#{h}" />
											<p:ajax event="change"
												update=":form:btnAgendar"
												process="@this" />
										</p:selectOneMenu>
										
										<!-- Mensagem informativa quando n√£o h√° hor√°rios -->
										<h:panelGroup rendered="#{empty agendamentoClienteController.horariosDisponiveis and agendamentoClienteController.dataSelecionada != null}">
											<div class="alert alert-warning mt-2" style="padding: 10px; background: #FFF3CD; border: 1px solid #FFECB5; border-radius: 4px; color: #856404; margin-top: 12px;">
												<i class="fa-solid fa-exclamation-triangle"></i>
												<strong>Aten√ß√£o:</strong> N√£o h√° hor√°rios dispon√≠veis para esta data.
											</div>
										</h:panelGroup>
									</div>
								</p:outputPanel>

								<p:outputPanel id="observacoesWrapper">
									<div class="input-combined">
										<p:outputLabel styleClass="title-input"
											value="Observa√ß√µes (Opcional)" />
										<p:inputTextarea id="observacoes"
											value="#{agendamentoClienteController.observacoes}"
											placeholder="Alguma observa√ß√£o para o atendimento?"
											rows="4"
											maxlength="500" />
									</div>
								</p:outputPanel>
							</div>

							<!-- Bot√µes do Passo 3 -->
							<div class="step-buttons">
								<p:commandButton value="Anterior" 
									styleClass="btn-step btn-step-previous"
									action="#{agendamentoClienteController.passoAnterior}"
									update=":form:stepsContainer"
									process="@this"
									ax="true" />
								<p:commandButton id="btnAgendar" value="AGENDAR" 
									styleClass="btn-step btn-step-finish"
									action="#{agendamentoClienteController.agendar}"
									disabled="#{not agendamentoClienteController.podeAgendar}"
									update=":form:bookingAreaPanel :form:msgs :form:listaAgendamentosPanel"
									process="@form"
									ax="true" />
							</div>
						</div>
					</h:panelGroup>
				</h:panelGroup>
			</div>
		</p:outputPanel>

		<p:dialog id="dlgConfirmCancelamento"
			widgetVar="dlgConfirmCancelamento" modal="true" showEffect="fade"
			hideEffect="fade" closable="false" draggable="false"
			resizable="false">
			<h:panelGroup id="dlgConfirmCancelamentoForm">
				<div class="header-modal-confirm">
					<div>
						<label>Deseja realmente cancelar este agendamento?</label>
					</div>
				</div>

				<div class="flex align-center justify-center">
					<p:commandButton styleClass="btn medium btn-confirm"
						value="Confirmar"
						actionListener="#{agendamentoClienteController.cancelarMeuAgendamento(agendamentoClienteController.agendamentoIdParaCancelar)}"
						process="@this"
						update=":form:listaAgendamentosPanel :form:msgs"
						oncomplete="PF('dlgConfirmCancelamento').hide();" />
					<p:commandButton styleClass="btn medium btn-cancel"
						value="Cancelar" onclick="PF('dlgConfirmCancelamento').hide()" />
				</div>
			</h:panelGroup>
		</p:dialog>
	</ui:define>

	<ui:define name="sidebar">
		<div class="content-agendamentos">
			<div class="flex" style="margin-bottom: 20px;">
				<div class="icon-circle">
					<i class="fa-solid fa-clock"></i>
				</div>
				<div class="subtitle-info">
					<label class="title-info">Seus agendamentos</label>
				</div>
			</div>

			<div class="appointment-list">
				<p:dataList id="listaAgendamentosPanel"
					value="#{agendamentoClienteController.meusAgendamentos}"
					var="agend" emptyMessage="Nenhum agendamento futuro."
					styleClass="ui-datalist-noborder">

					<div class="appointment-card">
						<div class="card-header">
							<div class="date-badge">
								<span class="day"> <h:outputText
										value="#{agend.dataCriado}">
										<f:convertDateTime pattern="dd" locale="pt_BR" />
									</h:outputText>
								</span> <span class="month"> <h:outputText
										value="#{agend.dataCriado}">
										<f:convertDateTime pattern="MMM" locale="pt_BR" />
									</h:outputText>
								</span>
							</div>
							<div class="time-badge">
								<i class="fa-regular fa-clock"></i> <span>#{agend.horaSelecionada}</span>
							</div>
						</div>

						<div class="card-body">
							<div class="info-row">
								<i class="fa-solid fa-user"></i> <span>#{agend.funcionario.nome}</span>
							</div>
							<div class="info-row services">
								<i class="fa-solid fa-scissors"></i> <span>#{agend.servicosConcatenados}</span>
							</div>
						</div>

						<div class="card-footer">
							<div class="appointment-meta">
								<div class="appointment-meta-item price">
									<i class="fa-solid fa-money-bill-wave"></i>
									<span>
										R$ <h:outputText value="#{agend.valorTotal}">
											<f:convertNumber pattern="0.00" groupingUsed="false" />
										</h:outputText>
									</span>
								</div>
								<div class="appointment-meta-item duration">
									<i class="pi pi-clock"></i>
									<span>#{agend.duracaoTotalFormatada}</span>
								</div>
							</div>
							<p:commandButton value="Cancelar" icon="fa-solid fa-trash-can"
								styleClass="btn-cancel-appointment" process="@this"
								onclick="PF('dlgConfirmCancelamento').show()">
								<f:setPropertyActionListener
									target="#{agendamentoClienteController.agendamentoIdParaCancelar}"
									value="#{agend.id}" />
							</p:commandButton>
						</div>

					</div>

				</p:dataList>
			</div>
		</div>
	</ui:define>

</ui:composition>
</html>