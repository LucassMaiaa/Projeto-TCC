<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="/WEB-INF/template.xhtml">

	<ui:define name="title">Restrições de Data - BarberSys</ui:define>
	<ui:param name="activeMenu" value="cadastros" />
	
	<ui:define name="extra-css">
		<h:outputScript library="primefaces" name="locales/locale-pt.js" />
		<style>
.content-info-lateral {
	background: #FCFCFF;
}

.header-filters {
	margin-top: 9px;
}

.dataList-custom.ui-datalist .ui-datalist-content {
	min-height: calc(100vh - 400px);
	max-height: calc(100vh - 400px);
	overflow-y: auto;
}

body .ui-datalist .ui-datalist-content {
	border: none;
	padding: 0;
}

.dataList-custom.ui-datalist .ui-datalist-empty-message {
	min-height: calc(100vh - 400px);
	display: flex;
	justify-content: center;
	align-items: center;
	font-size: 17px !important;
	font-weight: bold;
}

.restricao-card {
	display: flex;
	flex-direction: column;
	gap: 8px;
	transition: all 0.2s ease;
}

.restricao-card:hover {
	background: #F9FAFB !important;
}

.restricao-card-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	gap: 12px;
}

.restricao-data {
	display: flex;
	align-items: center;
	gap: 8px;
	font-weight: 600;
	font-size: 14px;
	color: #1F2937;
}

.restricao-data i {
	color: #6366F1;
	font-size: 16px;
}

.restricao-card-body {
	color: #6B7280;
	font-size: 13px;
	line-height: 1.5;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	font-weight: bold;
}

.restricao-tipo-badge {
	display: inline-flex;
	align-items: center;
	gap: 6px;
	padding: 5px 12px;
	border-radius: 16px;
	font-size: 11px;
	font-weight: 600;
	white-space: nowrap;
	flex-shrink: 0;
}

.restricao-tipo-badge.geral {
	background-color: #FEF3C7;
	color: #92400E;
	border: 1px solid #FCD34D;
}

.restricao-tipo-badge.funcionario {
	background-color: #DBEAFE;
	color: #1E40AF;
	border: 1px solid #93C5FD;
}

/* Seções do formulário */
.section-title {
	display: flex;
	align-items: center;
	gap: 10px;
	padding-bottom: 10px;
	margin-bottom: 15px;
	border-bottom: 2px solid #E7F3F5;
}

.section-title i {
	color: #4CAF50;
	font-size: 18px;
}

.section-title label {
	font-size: 16px;
	font-weight: 600;
	color: #2C3E50;
	margin: 0;
}

.mt10 {
	margin-top: 10px;
}

.mt20 {
	margin-top: 20px;
}

/* Ajustes no modal */
body .ui-dialog#dlgRestricao {
	width: 700px !important;
}

/* Estilo para o datePicker nos filtros */
.input-combined-no-text .p-datepicker,
.input-combined-no-text .ui-calendar,
.input-combined-no-text .p-calendar {
	width: 100% !important;
	position: relative !important;
	display: inline-flex !important;
}

.input-combined-no-text .p-datepicker .p-inputtext,
.input-combined-no-text .p-datepicker input,
.input-combined-no-text .p-calendar input,
.input-combined-no-text .ui-calendar .ui-inputfield {
	height: 46px !important;
	padding-right: 40px !important;
	padding-left: 12px !important;
	width: 100% !important;
	font-size: 14px !important;
	color: #656464 !important;
	font-weight: 600 !important;
	font-family: "Barlow" !important;
	border-radius: 8px !important;
	box-shadow: none !important;
	border: 1px solid #ced4da !important;
}

/* BOTÃO DO CALENDÁRIO - AZUL PADRÃO DO SISTEMA */
.input-combined-no-text .p-datepicker-trigger,
.input-combined-no-text .p-datepicker button,
.input-combined-no-text .p-calendar button,
.input-combined-no-text .ui-calendar .ui-button.ui-button-icon-only {
	width: 24px !important;
	height: 24px !important;
	min-width: 24px !important;
	position: absolute !important;
	right: 6px !important;
	bottom: 10px !important;
	border-radius: 8px !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	background: #457BF9 !important;
	border: transparent !important;
	z-index: 10 !important;
	padding: 0 !important;
}

.input-combined-no-text .p-datepicker-trigger .p-icon,
.input-combined-no-text .p-datepicker button .p-icon,
.input-combined-no-text .p-calendar button .p-icon,
.input-combined-no-text .p-datepicker-trigger svg,
.input-combined-no-text .p-datepicker button svg,
.input-combined-no-text .p-calendar button svg,
.input-combined-no-text .ui-calendar .ui-button.ui-button-icon-only .ui-icon-calendar {
	font-size: 12px !important;
	width: 12px !important;
	height: 12px !important;
	color: white !important;
	position: relative !important;
	top: 1px !important;
	left: 4.3px !important;
}

.input-combined-no-text .p-datepicker-trigger:hover,
.input-combined-no-text .p-datepicker button:hover,
.input-combined-no-text .p-calendar button:hover {
	background: #3667E3 !important;
}

/* Estilo para selectOneMenu nos filtros */
.input-combined-no-text .ui-selectonemenu {
	height: 46px !important;
	width: 100% !important;
}

.input-combined-no-text .ui-selectonemenu .ui-selectonemenu-trigger {
	width: 28px !important;
	height: 46px !important;
	background: transparent !important;
	border: none !important;
	position: absolute !important;
	right: 0px !important;
	top: 0px !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
}

.input-combined-no-text .ui-selectonemenu .ui-selectonemenu-trigger .ui-icon {
	background: #DEDEDE !important;
	width: 24px !important;
	height: 24px !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	border-radius: 8px !important;
	font-size: 12px !important;
	color: black !important;
	margin: 0 !important;
	position: relative !important;
	top: 0px !important;
	left: -6px !important;
	transform: none !important;
}

.input-combined-no-text .ui-selectonemenu .ui-selectonemenu-label {
	height: 46px !important;
	line-height: 46px !important;
	padding: 0 40px 0 12px !important;
	font-size: 14px !important;
	color: #656464 !important;
	font-weight: 600 !important;
	font-family: "Barlow" !important;
}

.input-combined-no-text .ui-selectonemenu.ui-state-focus,
.input-combined-no-text .ui-selectonemenu.ui-state-hover {
	border-color: #ced4da !important;
	box-shadow: none !important;
}

.btn-limpar {
	background: #6837DF !important;
	border-color: #6837DF !important;
	border-radius: 50px !important;
	height: 46px !important;
	width: 100% !important;
	padding: 0 20px !important;
	display: flex !important;
	align-items: center !important;
	justify-content: center !important;
	font-weight: 600 !important;
	font-size: 12px !important;
	color: white !important;
	text-transform: uppercase;
}

.btn-limpar:hover {
	background: #5829C7 !important;
	border-color: #5829C7 !important;
}

.btn-limpar .ui-button-text {
	padding: 0 !important;
}
		</style>
	</ui:define>

	<ui:define name="content">
	
		<div class="flex space-between">
			<p:outputLabel class="title-page" value="Restrições de Data" />
		</div>

		<div class="header-filters">
			<div class="row">
				<div class="col-md-4 input-combined-no-text">
					<p:inputText value="#{restricaoDataController.descricaoFiltro}" autocomplete="off"
						placeholder="Pesquisar por descrição">
						<p:ajax event="keyup" delay="100" update="@form" process="@this" />
					</p:inputText>
					<i class="fa-solid fa-magnifying-glass"></i>
				</div>
				<div class="col-md-3 input-combined-no-text">
					<p:datePicker 
						showIcon="true"
						value="#{restricaoDataController.dataInicial}" 
						pattern="dd/MM/yyyy"
						placeholder="Data Inicial"
						locale="pt">
						<p:ajax update="@form" process="@this" />
					</p:datePicker>
				</div>
				<div class="col-md-3 input-combined-no-text">
					<p:datePicker 
						showIcon="true"
						value="#{restricaoDataController.dataFinal}" 
						pattern="dd/MM/yyyy"
						placeholder="Data Final"
						locale="pt">
						<p:ajax update="@form" process="@this" />
					</p:datePicker>
				</div>
				<div class="col-md-2">
					<p:commandButton 
						value="Limpar" 
						styleClass="btn-limpar"
						actionListener="#{restricaoDataController.limparFiltros()}"
						update="@form"
						process="@this" />
				</div>
			</div>
		</div>

		<div class="flex align-center mt15 mb15">
			<p:commandButton
				actionListener="#{restricaoDataController.novaRestricao()}"
				update="form:dlgRestricao" process="@this" class="btn-circle-green"
				icon="fa fa-plus" oncomplete="PF('dlgRestricao').show()" />
			<label class="title-button ml8">Nova restrição</label>
		</div>

		<div>
			<p:dataList id="datatableRestricoes" rowIndexVar="row"
				class="dataList-custom"
				value="#{restricaoDataController.lstRestricoes}" var="restricao"
				paginator="true" paginatorPosition="bottom" rows="16" lazy="true"
				emptyMessage="Nenhuma restrição encontrada">
				<p:commandLink
					actionListener="#{restricaoDataController.restricaoSelecionada(restricao)}"
					update="form:dlgRestricao" process="@this"
					oncomplete="PF('dlgRestricao').show()">
					<div class="card-list restricao-card">
						<div class="restricao-card-header">
							<div class="restricao-data">
								<i class="fa-solid fa-calendar"></i>
								<h:outputText value="#{restricao.data}">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>
							</div>
							<span class="restricao-tipo-badge #{restricao.tipo == 'G' ? 'geral' : 'funcionario'}">
								<i class="fa-solid #{restricao.tipo == 'G' ? 'fa-users' : 'fa-user-tie'}"></i>
								#{restricao.tipo == 'G' ? 'Geral' : restricao.funcionario.nome}
							</span>
						</div>
						<div class="restricao-card-body">
							<p:outputLabel value="#{restricao.descricao}" />
						</div>
					</div>
				</p:commandLink>
			</p:dataList>
		</div>

		<p:dialog id="dlgRestricao" widgetVar="dlgRestricao" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<h:panelGroup id="dlgRestricaoForm">
				<div class="header-modal">
					<div class="flex align-center">
						<div class="icon-circle">
							<ui:fragment rendered="#{restricaoDataController.editarModel eq 'A'}">
								<i class="fa-solid fa-pen"></i>
							</ui:fragment>
							<ui:fragment rendered="#{restricaoDataController.editarModel eq 'I'}">
								<i class="fa-solid fa-calendar-xmark"></i>
							</ui:fragment>
						</div>
						<label>#{restricaoDataController.editarModel eq 'A' ?
							'Editar Restrição' : 'Nova Restrição'}</label>
					</div>
					<div class="flex align-center">
						<ui:fragment rendered="#{restricaoDataController.editarModel eq 'A'}">
							<p:commandButton update="@form" process="@this"
								styleClass="btn-trash" onclick="PF('dlgConfirm').show()"
								icon="fa-solid fa-trash" />
							<p:commandButton update="dlgRestricaoForm" process="@form"
								actionListener="#{restricaoDataController.atualizarRestricao()}"
								styleClass="btn btn-green" value="Salvar" />
						</ui:fragment>
						<ui:fragment rendered="#{restricaoDataController.editarModel eq 'I'}">
							<p:commandButton update="dlgRestricaoForm" process="@form"
								actionListener="#{restricaoDataController.adicionarNovaRestricao()}"
								styleClass="btn btn-green" value="Salvar" />
						</ui:fragment>

						<p:commandButton styleClass="btn-x" icon="fa-solid fa-xmark"
							onclick="PF('dlgRestricao').hide()" />
					</div>
				</div>

				<div class="dialog-scroll">
					<p:messages id="msgs" closable="true" showIcon="true" autoUpdate="true" />

					<div class="section-title mt10">
						<i class="fa-solid fa-calendar-days"></i>
						<label>Informações da Restrição</label>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Data *" />
								<p:datePicker id="dataRestricao" 
									styleClass="senha-login" 
									pattern="dd/MM/yyyy"
									value="#{restricaoDataController.restricaoModel.data}" 
									showIcon="true" 
									locale="pt"
									required="true"
									requiredMessage="A data é obrigatória." />
							</div>
						</div>
						<div class="col-md-6">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Tipo de Restrição *" />
								<p:selectOneMenu value="#{restricaoDataController.restricaoModel.tipo}"
									styleClass="senha-login">
									<f:selectItem itemLabel="Geral (Todos os funcionários)" itemValue="G" />
									<f:selectItem itemLabel="Funcionário Específico" itemValue="F" />
									<p:ajax event="change" update="dlgRestricaoForm" process="@this" />
								</p:selectOneMenu>
							</div>
						</div>
					</div>

					<ui:fragment rendered="#{restricaoDataController.restricaoModel.tipo == 'F'}">
						<div class="section-title mt20">
							<i class="fa-solid fa-user-tie"></i>
							<label>Selecionar Funcionário</label>
						</div>

						<div class="row">
							<div class="col-md-12">
								<div class="input-combined">
									<p:outputLabel styleClass="title-input" value="Funcionário *" />
									<p:selectOneMenu value="#{restricaoDataController.funcionarioId}"
										styleClass="senha-login">
										<f:selectItem itemLabel="Selecione um funcionário..." itemValue="" />
										<f:selectItems value="#{restricaoDataController.lstFuncionario}"
											var="func" itemLabel="#{func.nome}" itemValue="#{func.id}" />
									</p:selectOneMenu>
								</div>
							</div>
						</div>
					</ui:fragment>

					<div class="section-title mt20">
						<i class="fa-solid fa-circle-info"></i>
						<label>Descrição</label>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="input-combined">
								<p:outputLabel styleClass="title-input" value="Motivo da Restrição *" />
								<p:inputTextarea value="#{restricaoDataController.restricaoModel.descricao}"
									rows="3"
									styleClass="senha-login"
									placeholder="Ex: Feriado Nacional - Natal, Férias, Licença médica..." />
							</div>
						</div>
					</div>
				</div>

			</h:panelGroup>
		</p:dialog>

		<p:dialog id="dlgConfirm" widgetVar="dlgConfirm" modal="true"
			showEffect="fade" hideEffect="fade" closable="false"
			draggable="false" resizable="false">
			<h:panelGroup id="dlgConfirmForm">
				<div class="header-modal-confirm">
					<div>
						<label>Realmente deseja excluir essa restrição?</label>
					</div>
				</div>

				<div class="flex align-center justify-center">
					<p:commandButton styleClass="btn medium btn-confirm"
						value="Confirmar"
						actionListener="#{restricaoDataController.deletarRestricao()}" />
					<p:commandButton styleClass="btn medium btn-cancel"
						value="Cancelar" onclick="PF('dlgConfirm').hide()" />
				</div>
			</h:panelGroup>
		</p:dialog>
		
	</ui:define>

</ui:composition>
</html>
